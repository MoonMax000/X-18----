# üöÄ TOTP 2FA Deployment - –§–∏–Ω–∞–ª—å–Ω—ã–π –°—Ç–∞—Ç—É—Å

## ‚úÖ –ß—Ç–æ —É–∂–µ —Å–¥–µ–ª–∞–Ω–æ

### 1. Backend - –ü–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤
- ‚úÖ TOTP middleware —Å–æ–∑–¥–∞–Ω (`totp_required.go`)
- ‚úÖ Protected operations handlers —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞
- ‚úÖ –ö–æ–º–ø–∏–ª—è—Ü–∏—è —É—Å–ø–µ—à–Ω–∞ (–±–µ–∑ –æ—à–∏–±–æ–∫)
- ‚úÖ –ö–æ–¥ –∑–∞–∫–æ–º–º–∏—á–µ–Ω –≤ –≤–µ—Ç–∫—É `nova-hub`
- ‚úÖ –ö–æ–¥ –∑–∞–ø—É—à–µ–Ω –≤ GitHub
- ‚úÖ ENCRYPTION_KEY —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ Railway: `odx2pe5ACyfB77ObSKyPk4Vvs37L1ChxzWDlOM723LQ=`
- ‚úÖ Railway –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–¥–µ–ø–ª–æ–∏–ª backend

### 2. Frontend - –ü–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤
- ‚úÖ TOTPVerificationModal –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω
- ‚úÖ useProtectedOperations hook —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
- ‚úÖ useDebounce hook –¥–ª—è auto-save
- ‚úÖ ProfileSecuritySettings –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω —Å TOTP
- ‚úÖ Auto-save –¥–ª—è backup –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ –ö–æ–¥ –∑–∞–∫–æ–º–º–∏—á–µ–Ω –∏ –∑–∞–ø—É—à–µ–Ω
- ‚úÖ Netlify –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–¥–µ–ø–ª–æ–∏—Ç frontend

### 3. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- ‚úÖ –ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –¥–µ–ø–ª–æ—é —Å–æ–∑–¥–∞–Ω–æ
- ‚úÖ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—é –º–∏–≥—Ä–∞—Ü–∏–∏ –≥–æ—Ç–æ–≤–∞
- ‚úÖ –û—Ç—á–µ—Ç—ã –ø–æ –≤—Å–µ–º —ç—Ç–∞–ø–∞–º —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

## ‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û: –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é 009

### –ü—Ä–æ–±–ª–µ–º–∞
Railway CLI –Ω–µ –º–æ–∂–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –∏–∑-–∑–∞ –ø—Ä–æ–±–ª–µ–º —Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º –∫ —É–¥–∞–ª–µ–Ω–Ω–æ–π –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.

### ‚úã –ß–¢–û –ù–£–ñ–ù–û –°–î–ï–õ–ê–¢–¨ –í–†–£–ß–ù–£–Æ

**–û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª `–ü–†–ò–ú–ï–ù–ò–¢–¨_–ú–ò–ì–†–ê–¶–ò–Æ_009_–í–†–£–ß–ù–£–Æ.md` –∏ —Å–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º!**

–ö—Ä–∞—Ç–∫–æ:
1. –ó–∞–π—Ç–∏ –Ω–∞ https://railway.app
2. –û—Ç–∫—Ä—ã—Ç—å –≤–∞—à –ø—Ä–æ–µ–∫—Ç ‚Üí PostgreSQL —Å–µ—Ä–≤–∏—Å
3. –ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ –≤–∫–ª–∞–¥–∫—É "Query"
4. –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å SQL –∏–∑ —Ñ–∞–π–ª–∞ `apply-migration-009-now.sql`
5. –í—Å—Ç–∞–≤–∏—Ç—å –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç—å
6. –ì–æ—Ç–æ–≤–æ! üéâ

### SQL –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è (—Ç–∞–∫–∂–µ –≤ apply-migration-009-now.sql):

```sql
ALTER TABLE users ADD COLUMN IF NOT EXISTS totp_secret TEXT;
ALTER TABLE users ADD COLUMN IF NOT EXISTS totp_enabled BOOLEAN DEFAULT FALSE;
ALTER TABLE users ADD COLUMN IF NOT EXISTS is_deactivated BOOLEAN DEFAULT FALSE;
ALTER TABLE users ADD COLUMN IF NOT EXISTS deactivation_reason TEXT;
ALTER TABLE users ADD COLUMN IF NOT EXISTS deactivated_at TIMESTAMP;
ALTER TABLE users ADD COLUMN IF NOT EXISTS deletion_scheduled_at TIMESTAMP;

CREATE INDEX IF NOT EXISTS idx_users_deletion_scheduled ON users(deletion_scheduled_at) WHERE deletion_scheduled_at IS NOT NULL;
CREATE INDEX IF NOT EXISTS idx_users_totp_enabled ON users(totp_enabled) WHERE totp_enabled = TRUE;
```

## üéØ –ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–∏

–°—Ä–∞–∑—É –ø–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è SQL –≤ Railway Dashboard:

1. ‚úÖ Backend —É–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –Ω–æ–≤—ã–º –∫–æ–¥–æ–º
2. ‚úÖ Frontend —É–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –Ω–æ–≤—ã–º–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏
3. ‚úÖ TOTP 2FA –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–µ–Ω!

## üîê –ù–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

–ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å–º–æ–≥—É—Ç:

1. **–í–∫–ª—é—á–∏—Ç—å TOTP 2FA** –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
   - –°–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å QR-–∫–æ–¥ –≤ Google Authenticator / Authy
   - –ü–æ–ª—É—á–∞—Ç—å 6-–∑–Ω–∞—á–Ω—ã–µ –∫–æ–¥—ã –¥–ª—è –∑–∞—â–∏—â–µ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

2. **–ó–∞—â–∏—â–µ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏** (—Ç—Ä–µ–±—É—é—Ç TOTP –µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω):
   - –°–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è
   - –°–º–µ–Ω–∞ email
   - –°–º–µ–Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞

3. **Auto-save –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤**
   - Backup email –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –ø—Ä–∏ –≤–≤–æ–¥–µ
   - Backup —Ç–µ–ª–µ—Ñ–æ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –ø—Ä–∏ –≤–≤–æ–¥–µ
   - –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã "–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ..." ‚Üí "–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ ‚úì"

4. **–î–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—è –∞–∫–∫–∞—É–Ω—Ç–∞** (30 –¥–Ω–µ–π –Ω–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ)

## üìä –°—Ç–∞—Ç—É—Å –¥–µ–ø–ª–æ—è

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –°—Ç–∞—Ç—É—Å | –î–µ–π—Å—Ç–≤–∏–µ |
|-----------|--------|----------|
| Backend Code | ‚úÖ –ó–∞–¥–µ–ø–ª–æ–µ–Ω | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ Railway |
| Frontend Code | ‚úÖ –ó–∞–¥–µ–ø–ª–æ–µ–Ω | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ Netlify |
| Database Migration | ‚è≥ –¢—Ä–µ–±—É–µ—Ç—Å—è | **–ü—Ä–∏–º–µ–Ω–∏—Ç—å –≤—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ Railway Dashboard** |
| ENCRYPTION_KEY | ‚úÖ –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω | odx2pe5ACyfB77ObSKyPk4Vvs37L1ChxzWDlOM723LQ= |

## üéâ –ò—Ç–æ–≥

**99% –≥–æ—Ç–æ–≤–æ!** 

–û—Å—Ç–∞–ª–æ—Å—å —Ç–æ–ª—å–∫–æ –ø—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é 009 —á–µ—Ä–µ–∑ Railway Dashboard (–∑–∞–π–º–µ—Ç 2 –º–∏–Ω—É—Ç—ã).

–°–º. –ø–æ–¥—Ä–æ–±–Ω—É—é –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é –≤ —Ñ–∞–π–ª–µ: **`–ü–†–ò–ú–ï–ù–ò–¢–¨_–ú–ò–ì–†–ê–¶–ò–Æ_009_–í–†–£–ß–ù–£–Æ.md`**
