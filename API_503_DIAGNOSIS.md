# üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ 503 –æ—à–∏–±–∫–∏ (09:20 08.11.2025)

## –ü—Ä–æ–±–ª–µ–º–∞

–ë—Ä–∞—É–∑–µ—Ä –ø–æ–ª—É—á–∞–µ—Ç **503 Service Unavailable** –Ω–∞ –≤—Å–µ API –∑–∞–ø—Ä–æ—Å—ã:
```
[Error] Preflight response is not successful. Status code: 503
[Error] Fetch API cannot load https://api.tyriantrade.com/api/auth/login due to access control checks.
```

## –ü—Ä–∏—á–∏–Ω–∞

**Rolling Update –≤ ECS** - –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –∑–∞–ø—É—â–µ–Ω—ã 2 –∑–∞–¥–∞—á–∏:
- –ù–æ–≤–∞—è –∑–∞–¥–∞—á–∞ (Deploy #3) 
- –°—Ç–∞—Ä–∞—è –∑–∞–¥–∞—á–∞ (Deploy #2)

–í–æ –≤—Ä–µ–º—è rolling update –æ–±–µ –∑–∞–¥–∞—á–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç –∑–∞–ø—Ä–æ—Å—ã —á–µ—Ä–µ–∑ Load Balancer, —á—Ç–æ –≤—ã–∑—ã–≤–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—ã —Å CORS preflight –∑–∞–ø—Ä–æ—Å–∞–º–∏.

## –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å

```
Running Count: 2
Desired Count: 1
```

**Target Health:**
- Target 1 (10.0.11.87:8080): ‚úÖ healthy
- Target 2 (10.0.11.81:8080): ‚úÖ healthy

**API Health Check:**
```bash
$ curl https://api.tyriantrade.com/health
HTTP/2 200
{"env":"production","status":"ok"}
```

‚úÖ API —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–æ—Ä–º–∞–ª—å–Ω–æ –ø—Ä–∏ –ø—Ä—è–º—ã—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö  
‚ùå CORS preflight –∑–∞–ø—Ä–æ—Å—ã (OPTIONS) –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç 503

## –†–µ—à–µ–Ω–∏–µ

**–ü–û–î–û–ñ–î–ê–¢–¨** –ø–æ–∫–∞ rolling update –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è (2-5 –º–∏–Ω—É—Ç):

1. ECS –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç —Å—Ç–∞—Ä—É—é –∑–∞–¥–∞—á—É
2. Running count —Å—Ç–∞–Ω–µ—Ç —Ä–∞–≤–µ–Ω 1
3. 503 –æ—à–∏–±–∫–∏ –∏—Å—á–µ–∑–Ω—É—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å:
```bash
aws ecs describe-services \
  --cluster tyriantrade-cluster \
  --services tyriantrade-backend-service \
  --region us-east-1 \
  --query 'services[0].{running:runningCount,desired:desiredCount}' \
  --output json
```

–ö–æ–≥–¥–∞ `runningCount` —Å—Ç–∞–Ω–µ—Ç `1` - –ø—Ä–æ–±–ª–µ–º–∞ —Ä–µ—à–µ–Ω–∞.

## –í—Ä–µ–º–µ–Ω–Ω–∞—è –ª–∏–Ω–∏—è

- **09:14**: Deploy #3 –∑–∞–ø—É—Å—Ç–∏–ª –Ω–æ–≤—É—é –∑–∞–¥–∞—á—É
- **09:18**: –ù–æ–≤–∞—è –∑–∞–¥–∞—á–∞ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∞ –≤ target group
- **09:20**: –û–±–µ –∑–∞–¥–∞—á–∏ —Ä–∞–±–æ—Ç–∞—é—Ç (temporary 503 on CORS)
- **~09:22-09:25**: –û–∂–∏–¥–∞–µ—Ç—Å—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å—Ç–∞—Ä–æ–π –∑–∞–¥–∞—á–∏

## –ü–æ—á–µ–º—É —ç—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç?

Rolling update –≤ ECS —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–∞–∫:
1. –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –Ω–æ–≤–∞—è –∑–∞–¥–∞—á–∞
2. –ü—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è health checks (2-3 –º–∏–Ω—É—Ç—ã)
3. –ù–æ–≤–∞—è –∑–∞–¥–∞—á–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç—Å—è –≤ load balancer
4. –°—Ç–∞—Ä–∞—è –∑–∞–¥–∞—á–∞ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è

**–í—Ä–µ–º–µ–Ω–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞**: –ü–æ–∫–∞ —Ä–∞–±–æ—Ç–∞—é—Ç –æ–±–µ –∑–∞–¥–∞—á–∏, Load Balancer –º–æ–∂–µ—Ç –Ω–∞–ø—Ä–∞–≤–ª—è—Ç—å CORS preflight –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ —Å—Ç–∞—Ä—É—é –∑–∞–¥–∞—á—É, –∫–æ—Ç–æ—Ä–∞—è —É–∂–µ —á–∞—Å—Ç–∏—á–Ω–æ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –∏–ª–∏ –∏–º–µ–µ—Ç –ø—Ä–æ–±–ª–µ–º—ã —Å CORS headers.

## –ß—Ç–æ –ù–ï –¥–µ–ª–∞—Ç—å

‚ùå –ù–ï –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞—Ç—å —Å–µ—Ä–≤–∏—Å  
‚ùå –ù–ï –æ—Ç–∫–∞—Ç—ã–≤–∞—Ç—å deployment  
‚ùå –ù–ï –º–µ–Ω—è—Ç—å –∫–æ–¥

‚úÖ –ü—Ä–æ—Å—Ç–æ –ø–æ–¥–æ–∂–¥–∞—Ç—å 2-5 –º–∏–Ω—É—Ç

---

**–°—Ç–∞—Ç—É—Å**: ‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è rolling update  
**ETA**: 2-5 –º–∏–Ω—É—Ç  
**–î–µ–π—Å—Ç–≤–∏–µ**: –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É —á–µ—Ä–µ–∑ 5 –º–∏–Ω—É—Ç
