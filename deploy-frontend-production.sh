#!/bin/bash

# üöÄ –°–∫—Ä–∏–ø—Ç –¥–ª—è –¥–µ–ø–ª–æ—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ –Ω–∞ Netlify
# –ü—Ä–∏–º–µ–Ω—è–µ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è production URL –∏ –¥–µ–ø–ª–æ–∏—Ç

set -e

echo "üöÄ –î–µ–ø–ª–æ–π —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ –Ω–∞ Netlify —Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è–º–∏"
echo "================================================"
echo ""

# 1. –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ –º—ã –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
if [ ! -f "package.json" ]; then
    echo "‚ùå –û—à–∏–±–∫–∞: package.json –Ω–µ –Ω–∞–π–¥–µ–Ω"
    echo "–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç –∏–∑ –∫–æ—Ä–Ω—è –ø—Ä–æ–µ–∫—Ç–∞"
    exit 1
fi

# 2. –°–±–æ—Ä–∫–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞
echo "üì¶ –°–±–æ—Ä–∫–∞ production –≤–µ—Ä—Å–∏–∏..."
npm run build

# 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–±–æ—Ä–∫–∏
if [ ! -d "dist" ]; then
    echo "‚ùå –û—à–∏–±–∫–∞ —Å–±–æ—Ä–∫–∏ - –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è dist –Ω–µ —Å–æ–∑–¥–∞–Ω–∞"
    exit 1
fi

echo ""
echo "‚úÖ –°–±–æ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞"
echo ""

# 4. –î–µ–ø–ª–æ–π –Ω–∞ Netlify
echo "üåê –î–µ–ø–ª–æ–π –Ω–∞ Netlify..."
echo ""

# –ü—Ä–æ–≤–µ—Ä–∫–∞ Netlify CLI
if ! command -v netlify &> /dev/null; then
    echo "‚ùå Netlify CLI –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"
    echo "–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ: npm install -g netlify-cli"
    exit 1
fi

# –î–µ–ø–ª–æ–π
netlify deploy --prod --dir=dist

echo ""
echo "‚ú® –î–µ–ø–ª–æ–π –∑–∞–≤–µ—Ä—à–µ–Ω!"
echo ""
echo "üìã –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ:"
echo "  ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω API URL –Ω–∞: https://x-18-production-38ec.up.railway.app"
echo "  ‚úÖ –°–æ–±—Ä–∞–Ω–∞ production –≤–µ—Ä—Å–∏—è"
echo "  ‚úÖ –ó–∞–¥–µ–ø–ª–æ–µ–Ω–æ –Ω–∞ Netlify"
echo ""
echo "üåê –í–∞—à —Å–∞–π—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É: https://social.tyriantrade.com"
echo ""
echo "‚ö†Ô∏è  –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: –∏–∑–º–µ–Ω–µ–Ω–∏—è –º–æ–≥—É—Ç –∑–∞–Ω—è—Ç—å 1-2 –º–∏–Ω—É—Ç—ã –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è"
