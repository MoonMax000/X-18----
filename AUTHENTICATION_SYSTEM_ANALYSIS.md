# Ğ¢ĞµÑ…Ğ½Ğ¸Ñ‡ĞµÑĞºĞ°Ñ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹ Ğ°ÑƒÑ‚ĞµĞ½Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ğ¸ X-18

## ğŸ“‹ ĞĞ³Ğ»Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ
1. [ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹](#Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°-ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹)
2. [ĞœĞµÑ‚Ğ¾Ğ´Ñ‹ Ğ°ÑƒÑ‚ĞµĞ½Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ğ¸](#Ğ¼ĞµÑ‚Ğ¾Ğ´Ñ‹-Ğ°ÑƒÑ‚ĞµĞ½Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ğ¸)
3. [Ğ¢ĞµÑ…Ğ½Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ ÑÑ‚ĞµĞº](#Ñ‚ĞµÑ…Ğ½Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹-ÑÑ‚ĞµĞº)
4. [ĞŸĞ¾Ñ‚Ğ¾ĞºĞ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…](#Ğ¿Ğ¾Ñ‚Ğ¾ĞºĞ¸-Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…)
5. [Ğ‘ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚ÑŒ](#Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚ÑŒ)
6. [Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğµ ÑƒĞ»ÑƒÑ‡ÑˆĞµĞ½Ğ¸Ñ](#Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğµ-ÑƒĞ»ÑƒÑ‡ÑˆĞµĞ½Ğ¸Ñ)
7. [ĞšĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹](#ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹-ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹)
8. [API Endpoints](#api-endpoints)
9. [Ğ‘Ğ°Ğ·Ğ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…](#Ğ±Ğ°Ğ·Ğ°-Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…)
10. [Ğ ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ğ¸ Ğ´Ğ»Ñ Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ°](#Ñ€ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ğ¸-Ğ´Ğ»Ñ-Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ°)

---

## ğŸ—ï¸ ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹

### ĞĞ±Ñ‰Ğ°Ñ Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Frontend (React)                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ LoginModal   â”‚  â”‚ SignUpModal  â”‚  â”‚ OAuth Buttonsâ”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Backend (Go + Fiber)                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ Auth Handler â”‚  â”‚ OAuth Handlerâ”‚  â”‚ TOTP Handler â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ JWT Middlewareâ”‚ â”‚ Rate Limiter â”‚  â”‚Security Srv  â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â–¼                   â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚  PostgreSQL  â”‚    â”‚    Redis     â”‚
          â”‚  (Main DB)   â”‚    â”‚   (Cache)    â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚  AWS SES     â”‚
          â”‚  (Email)     â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” ĞœĞµÑ‚Ğ¾Ğ´Ñ‹ Ğ°ÑƒÑ‚ĞµĞ½Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ğ¸

### 1. Email/Password (Traditional Auth)

**Ğ¢ĞµÑ…Ğ½Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ğ¸:**
- Bcrypt Ğ´Ğ»Ñ Ñ…ĞµÑˆĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ Ğ¿Ğ°Ñ€Ğ¾Ğ»ĞµĞ¹ (cost factor: 10)
- JWT Ñ‚Ğ¾ĞºĞµĞ½Ñ‹ (Access + Refresh)
- HttpOnly cookies Ğ´Ğ»Ñ Refresh Ñ‚Ğ¾ĞºĞµĞ½Ğ¾Ğ²
- Email Ğ²ĞµÑ€Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ñ Ñ‡ĞµÑ€ĞµĞ· AWS SES

**ĞŸĞ¾Ñ‚Ğ¾Ğº Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ğ¸:**
```
1. POST /api/auth/register
   â†“
2. Ğ’Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… (username, email, password)
   â†“
3. Ğ¥ĞµÑˆĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¿Ğ°Ñ€Ğ¾Ğ»Ñ (Bcrypt)
   â†“
4. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ Ğ² Ğ‘Ğ”
   â†“
5. Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ 6-Ğ·Ğ½Ğ°Ñ‡Ğ½Ğ¾Ğ³Ğ¾ ĞºĞ¾Ğ´Ğ° Ğ²ĞµÑ€Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ğ¸
   â†“
6. Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ ĞºĞ¾Ğ´Ğ° Ğ² Redis (TTL: 15 Ğ¼Ğ¸Ğ½ÑƒÑ‚)
   â†“
7. ĞÑ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ° email Ñ ĞºĞ¾Ğ´Ğ¾Ğ¼ (AWS SES)
   â†“
8. Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‚: requires_email_verification=true
```

**ĞŸĞ¾Ñ‚Ğ¾Ğº Ğ²Ñ…Ğ¾Ğ´Ğ°:**
```
1. POST /api/auth/login
   â†“
2. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²Ğ¾Ğº (IP/Account)
   â†“
3. ĞŸĞ¾Ğ¸ÑĞº Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ Ğ¿Ğ¾ email
   â†“
4. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ¿Ğ°Ñ€Ğ¾Ğ»Ñ (Bcrypt)
   â†“
5. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° 2FA (ĞµÑĞ»Ğ¸ Ğ²ĞºĞ»ÑÑ‡ĞµĞ½)
   â”œâ”€ Ğ”Ğ°: ĞÑ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ° 2FA ĞºĞ¾Ğ´Ğ° â†’ Ğ¾Ğ¶Ğ¸Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ¿Ğ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ¶Ğ´ĞµĞ½Ğ¸Ñ
   â””â”€ ĞĞµÑ‚: Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ JWT Ñ‚Ğ¾ĞºĞµĞ½Ğ¾Ğ²
   â†“
6. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ ÑĞµÑÑĞ¸Ğ¸ Ğ² Ğ‘Ğ”
   â†“
7. Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ° Refresh token Ğ² HttpOnly cookie
   â†“
8. Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‚ Access token + user data
```

**Ğ‘ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚ÑŒ:**
- Rate limiting (5 Ğ¿Ğ¾Ğ¿Ñ‹Ñ‚Ğ¾Ğº/Ğ¼Ğ¸Ğ½ÑƒÑ‚Ñƒ Ğ½Ğ° email)
- Ğ‘Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²ĞºĞ° IP Ğ¿Ğ¾ÑĞ»Ğµ 10 Ğ½ĞµÑƒĞ´Ğ°Ñ‡Ğ½Ñ‹Ñ… Ğ¿Ğ¾Ğ¿Ñ‹Ñ‚Ğ¾Ğº (30 Ğ¼Ğ¸Ğ½ÑƒÑ‚)
- Ğ‘Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²ĞºĞ° Ğ°ĞºĞºĞ°ÑƒĞ½Ñ‚Ğ° Ğ¿Ğ¾ÑĞ»Ğµ 5 Ğ½ĞµÑƒĞ´Ğ°Ñ‡Ğ½Ñ‹Ñ… Ğ¿Ğ¾Ğ¿Ñ‹Ñ‚Ğ¾Ğº (15 Ğ¼Ğ¸Ğ½ÑƒÑ‚)
- CSRF Ğ·Ğ°Ñ‰Ğ¸Ñ‚Ğ° Ñ‡ĞµÑ€ĞµĞ· SameSite cookies
- XSS Ğ·Ğ°Ñ‰Ğ¸Ñ‚Ğ° Ñ‡ĞµÑ€ĞµĞ· HttpOnly cookies

---

### 2. OAuth 2.0 (Google & Apple Sign-In)

**Ğ¢ĞµÑ…Ğ½Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ğ¸:**
- OAuth 2.0 protocol
- Google OAuth API
- Apple Sign In API
- JWT Ğ´Ğ»Ñ Apple (RS256)
- State tokens Ğ´Ğ»Ñ CSRF Ğ·Ğ°Ñ‰Ğ¸Ñ‚Ñ‹

**ĞŸÑ€Ğ¾Ğ²Ğ°Ğ¹Ğ´ĞµÑ€Ñ‹:**

#### Google OAuth
```go
Config: {
  ClientID: Ğ¸Ğ· env
  ClientSecret: Ğ¸Ğ· env
  RedirectURL: http://localhost:5173/auth/google/callback
  Scopes: [userinfo.email, userinfo.profile]
  Endpoint: google.Endpoint
}
```

#### Apple Sign In
```go
Config: {
  ClientID: Ğ¸Ğ· env (Service ID)
  ClientSecret: Ğ³ĞµĞ½ĞµÑ€Ğ¸Ñ€ÑƒĞµÑ‚ÑÑ JWT Ñ Ğ¿Ñ€Ğ¸Ğ²Ğ°Ñ‚Ğ½Ñ‹Ğ¼ ĞºĞ»ÑÑ‡Ğ¾Ğ¼
  RedirectURL: http://localhost:5173/auth/apple/callback
  Scopes: [name, email]
  TeamID, KeyID: Ğ¸Ğ· env
}
```

**ĞŸĞ¾Ñ‚Ğ¾Ğº OAuth (Ğ½Ğ¾Ğ²Ñ‹Ğ¹ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ):**
```
1. GET /api/auth/google (Ğ¸Ğ»Ğ¸ /apple)
   â†“
2. Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ state token (32 Ğ±Ğ°Ğ¹Ñ‚Ğ° random)
   â†“
3. Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ state Ğ² Redis (TTL: 10 Ğ¼Ğ¸Ğ½ÑƒÑ‚)
   â†“
4. Ğ ĞµĞ´Ğ¸Ñ€ĞµĞºÑ‚ Ğ½Ğ° OAuth Ğ¿Ñ€Ğ¾Ğ²Ğ°Ğ¹Ğ´ĞµÑ€Ğ°
   â†“
5. ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ°Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ğ·ÑƒĞµÑ‚ÑÑ
   â†“
6. Callback: GET /api/auth/google/callback?code=...&state=...
   â†“
7. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° state token
   â†“
8. ĞĞ±Ğ¼ĞµĞ½ code Ğ½Ğ° access token
   â†“
9. ĞŸĞ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğµ user info Ğ¾Ñ‚ Ğ¿Ñ€Ğ¾Ğ²Ğ°Ğ¹Ğ´ĞµÑ€Ğ°
   â†“
10. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ°: email ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒĞµÑ‚ Ğ² Ğ‘Ğ”?
    â”œâ”€ ĞĞµÑ‚: Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ½Ğ¾Ğ²Ğ¾Ğ³Ğ¾ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
    â”‚   â†“
    â”‚   - Username Ğ¸Ğ· email (Ğ´Ğ¾ @)
    â”‚   - Password: "" (Ğ¿ÑƒÑÑ‚Ğ¾Ğ¹)
    â”‚   - oauth_provider: "google"/"apple"
    â”‚   - oauth_provider_id: ID Ğ¾Ñ‚ Ğ¿Ñ€Ğ¾Ğ²Ğ°Ğ¹Ğ´ĞµÑ€Ğ°
    â”‚   - is_email_verified: true (ĞµÑĞ»Ğ¸ Ğ¾Ñ‚ Ğ¿Ñ€Ğ¾Ğ²Ğ°Ğ¹Ğ´ĞµÑ€Ğ°)
    â”‚   â†“
    â””â”€ Ğ”Ğ°: SECURITY FLOW (ÑĞ¼. Ğ½Ğ¸Ğ¶Ğµ)
   â†“
11. Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ JWT Ñ‚Ğ¾ĞºĞµĞ½Ğ¾Ğ²
    â†“
12. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ ÑĞµÑÑĞ¸Ğ¸
    â†“
13. Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‚ Ñ‚Ğ¾ĞºĞµĞ½Ğ¾Ğ² + user data
```

**SECURITY FLOW (ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‰Ğ¸Ğ¹ email):**
```
10b. Email Ğ½Ğ°Ğ¹Ğ´ĞµĞ½ Ğ² Ğ‘Ğ”, Ğ½Ğ¾ OAuth Ğ½Ğµ ÑĞ²ÑĞ·Ğ°Ğ½
     â†“
11. Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ linking_token (32 Ğ±Ğ°Ğ¹Ñ‚Ğ°)
    â†“
12. Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ² Redis:
    Key: oauth_link_request:{token}
    Value: provider|provider_id|email|name|avatar|verified|user_id
    TTL: 10 Ğ¼Ğ¸Ğ½ÑƒÑ‚
    â†“
13. Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‚ 409 Conflict:
    {
      "requires_account_linking": true,
      "email": "user@example.com",
      "provider": "google",
      "linking_token": "...",
      "message": "Account exists. Confirm to link."
    }
    â†“
14. Frontend Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ Ñ„Ğ¾Ñ€Ğ¼Ñƒ Ğ²Ğ²Ğ¾Ğ´Ğ° Ğ¿Ğ°Ñ€Ğ¾Ğ»Ñ
    â†“
15. POST /api/auth/oauth/link/confirm
    {
      "linking_token": "...",
      "password": "user_password"
    }
    â†“
16. ĞŸĞ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ¸Ğ· Redis
    â†“
17. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ¿Ğ°Ñ€Ğ¾Ğ»Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
    â†“
18. Ğ¡Ğ²ÑĞ·Ñ‹Ğ²Ğ°Ğ½Ğ¸Ğµ OAuth:
    UPDATE users SET 
      oauth_provider = 'google',
      oauth_provider_id = '...'
    WHERE id = user_id
    â†“
19. Ğ£Ğ´Ğ°Ğ»ĞµĞ½Ğ¸Ğµ linking_token Ğ¸Ğ· Redis
    â†“
20. ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ Ğ²Ñ…Ğ¾Ğ´ (JWT + session)
```

**Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ OAuth:**

1. **Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ° Ğ¿Ğ°Ñ€Ğ¾Ğ»Ñ (OAuth â†’ Mixed)**
```
POST /api/auth/oauth/set-password
Authorization: Bearer {access_token}
Body: { "password": "new_password" }

ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸:
- User Ğ°ÑƒÑ‚ĞµĞ½Ñ‚Ğ¸Ñ„Ğ¸Ñ†Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½
- Ğ£ user Ğ½ĞµÑ‚ Ğ¿Ğ°Ñ€Ğ¾Ğ»Ñ (password == "")
- ĞŸĞ°Ñ€Ğ¾Ğ»ÑŒ ÑĞ¾Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ÑƒĞµÑ‚ Ñ‚Ñ€ĞµĞ±Ğ¾Ğ²Ğ°Ğ½Ğ¸ÑĞ¼

Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚:
- Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ° Ñ…ĞµÑˆĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ¾Ğ³Ğ¾ Ğ¿Ğ°Ñ€Ğ¾Ğ»Ñ
- Ğ¢ĞµĞ¿ĞµÑ€ÑŒ Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ²Ğ¾Ğ¹Ñ‚Ğ¸ Ñ‡ĞµÑ€ĞµĞ· email/password
```

2. **ĞÑ‚Ğ²ÑĞ·ĞºĞ° OAuth (Mixed â†’ Password only)**
```
POST /api/auth/oauth/unlink
Authorization: Bearer {access_token}
Body: { "password": "current_password" }

ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸:
- User Ğ°ÑƒÑ‚ĞµĞ½Ñ‚Ğ¸Ñ„Ğ¸Ñ†Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½
- OAuth ÑĞ²ÑĞ·Ğ°Ğ½ (oauth_provider != "")
- Ğ•ÑÑ‚ÑŒ Ğ¿Ğ°Ñ€Ğ¾Ğ»ÑŒ (password != "") - Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚ÑŒ!
- ĞŸĞ°Ñ€Ğ¾Ğ»ÑŒ Ğ²ĞµÑ€Ğ½Ñ‹Ğ¹

Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚:
- oauth_provider = ""
- oauth_provider_id = ""
- ĞÑÑ‚Ğ°ĞµÑ‚ÑÑ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ email/password Ğ²Ñ…Ğ¾Ğ´
```

3. **Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ OAuth**
```
GET /api/auth/oauth/status
Authorization: Bearer {access_token}

ĞÑ‚Ğ²ĞµÑ‚: {
  "has_password": true/false,
  "has_oauth": true/false,
  "oauth_provider": "google"/"apple"/"",
  "can_unlink_oauth": true/false,
  "can_set_password": true/false
}
```

---

### 3. Two-Factor Authentication (2FA)

**Ğ¢ĞµÑ…Ğ½Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ğ¸:**
- TOTP (Time-based OTP) - RFC 6238
- Base32 encoding Ğ´Ğ»Ñ ÑĞµĞºÑ€ĞµÑ‚Ğ¾Ğ²
- QR codes Ğ´Ğ»Ñ mobile apps
- AES-256-GCM ÑˆĞ¸Ñ„Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ ÑĞµĞºÑ€ĞµÑ‚Ğ¾Ğ²
- Backup codes (bcrypt Ñ…ĞµÑˆĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ)

**ĞœĞµÑ‚Ğ¾Ğ´Ñ‹ 2FA:**

#### Email 2FA
```
1. Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ 6-Ğ·Ğ½Ğ°Ñ‡Ğ½Ğ¾Ğ³Ğ¾ ĞºĞ¾Ğ´Ğ°
2. Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ Ğ² Redis (TTL: 10 Ğ¼Ğ¸Ğ½ÑƒÑ‚)
3. ĞÑ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ° Ñ‡ĞµÑ€ĞµĞ· AWS SES
4. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° ĞºĞ¾Ğ´Ğ° Ğ¿Ñ€Ğ¸ Ğ²Ñ…Ğ¾Ğ´Ğµ
```

#### TOTP 2FA (Authenticator Apps)
```
1. POST /api/totp/generate
   â†“
2. Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ random secret (32 Ğ±Ğ°Ğ¹Ñ‚Ğ°)
   â†“
3. Ğ¨Ğ¸Ñ„Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ secret (AES-256-GCM)
   â†“
4. Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ encrypted secret Ğ² Ğ‘Ğ”
   â†“
5. Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ QR code URL
   â†“
6. Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‚: secret, qr_url, backup_codes
   â†“
7. User ÑĞºĞ°Ğ½Ğ¸Ñ€ÑƒĞµÑ‚ QR Ğ² Google Authenticator
   â†“
8. POST /api/totp/enable
   Body: { "code": "123456" }
   â†“
9. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° ĞºĞ¾Ğ´Ğ°
   â†“
10. ĞĞºÑ‚Ğ¸Ğ²Ğ°Ñ†Ğ¸Ñ TOTP (totp_enabled = true)
```

**TOTP Ğ°Ğ»Ğ³Ğ¾Ñ€Ğ¸Ñ‚Ğ¼:**
```go
func GenerateTOTP(secret string, time time.Time) string {
  counter := time.Unix() / 30  // 30-ÑĞµĞºÑƒĞ½Ğ´Ğ½Ñ‹Ğµ Ğ¾ĞºĞ½Ğ°
  hash := HMAC-SHA1(secret, counter)
  offset := hash[19] & 0xf
  truncated := hash[offset:offset+4]
  code := binary.BigEndian.Uint32(truncated) & 0x7fffffff
  return fmt.Sprintf("%06d", code % 1000000)
}
```

**Backup Codes:**
```
1. Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ 10 ÑĞ»ÑƒÑ‡Ğ°Ğ¹Ğ½Ñ‹Ñ… ĞºĞ¾Ğ´Ğ¾Ğ² (16 ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ğ¾Ğ²)
2. Ğ¥ĞµÑˆĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ³Ğ¾ (Bcrypt)
3. Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ Ğ² Ğ‘Ğ”
4. Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‚ plain codes Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ (Ğ¾Ğ´Ğ¸Ğ½ Ñ€Ğ°Ğ·!)
5. ĞŸÑ€Ğ¸ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğ¸:
   - ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° bcrypt
   - Ğ£Ğ´Ğ°Ğ»ĞµĞ½Ğ¸Ğµ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ¾Ğ³Ğ¾ ĞºĞ¾Ğ´Ğ°
   - Ğ£Ğ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğµ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
```

**Protected Operations (Ñ‚Ñ€ĞµĞ±ÑƒÑÑ‚ TOTP):**
```
Endpoints Ñ TOTPRequired middleware:
- POST /api/auth/password/change
- POST /api/users/email/change
- POST /api/users/phone/change

Endpoints Ñ TOTPOptional middleware:
- POST /api/auth/delete-account
- POST /api/account/deactivate

Flow:
1. Request Ñ Access token
   â†“
2. JWT middleware â†’ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ñ‚Ğ¾ĞºĞµĞ½Ğ°
   â†“
3. TOTP middleware â†’ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ° is_2fa_enabled
   â”œâ”€ false: Ğ¿Ñ€Ğ¾Ğ¿ÑƒÑĞº
   â””â”€ true: Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ° TOTP header
       â†“
       X-TOTP-Code header Ğ¿Ñ€Ğ¸ÑÑƒÑ‚ÑÑ‚Ğ²ÑƒĞµÑ‚?
       â”œâ”€ Ğ”Ğ°: ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° ĞºĞ¾Ğ´Ğ°
       â””â”€ ĞĞµÑ‚: 403 + "TOTP required"
```

---

## ğŸ› ï¸ Ğ¢ĞµÑ…Ğ½Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ ÑÑ‚ĞµĞº

### Backend
```yaml
Ğ¯Ğ·Ñ‹Ğº: Go 1.21+
Framework: Fiber v2 (Express-like Ğ´Ğ»Ñ Go)
Ğ‘Ğ°Ğ·Ğ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…: PostgreSQL 15
ĞšĞµÑˆ: Redis 7
ORM: GORM
```

### ĞÑƒÑ‚ĞµĞ½Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ñ
```yaml
JWT: golang-jwt/jwt v5
OAuth: golang.org/x/oauth2
TOTP: pquerna/otp
Bcrypt: golang.org/x/crypto/bcrypt
AES: crypto/aes (GCM mode)
```

### Email
```yaml
Provider: AWS SES
SDK: aws-sdk-go-v2/service/sesv2
Templates: HTML + Plain text
Rate limiting: 14 emails/second (SES limit)
```

### Frontend
```yaml
Ğ¯Ğ·Ñ‹Ğº: TypeScript
Framework: React 18
State: Redux Toolkit
HTTP: Axios
Routing: React Router v6
```

### Ğ‘ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚ÑŒ
```yaml
Rate Limiting: Custom middleware + Redis
CORS: Fiber CORS middleware
CSRF: SameSite cookies
XSS: HttpOnly cookies
SQL Injection: GORM prepared statements
Input Validation: go-playground/validator
```

---

## ğŸ”„ ĞŸĞ¾Ñ‚Ğ¾ĞºĞ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…

### JWT Token Flow
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Client    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 1. POST /login (email, password)
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            Auth Handler                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ 1. Validate credentials            â”‚ â”‚
â”‚  â”‚ 2. Generate tokens:                â”‚ â”‚
â”‚  â”‚    - Access (15min, in response)   â”‚ â”‚
â”‚  â”‚    - Refresh (7d, HttpOnly cookie) â”‚ â”‚
â”‚  â”‚ 3. Create session in DB            â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 2. Response: {access_token, user}
       â”‚    Set-Cookie: refresh_token (HttpOnly)
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Client    â”‚
â”‚ Stores:     â”‚
â”‚ - access in â”‚
â”‚   memory    â”‚
â”‚ - refresh   â”‚
â”‚   in cookie â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 3. API Request
       â”‚    Authorization: Bearer {access_token}
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         JWT Middleware                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ 1. Extract token from header       â”‚ â”‚
â”‚  â”‚ 2. Validate signature (HS256)      â”‚ â”‚
â”‚  â”‚ 3. Check expiration                â”‚ â”‚
â”‚  â”‚ 4. Extract user ID                 â”‚ â”‚
â”‚  â”‚ 5. Set to context                  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 4. Request proceeds
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Handler    â”‚
â”‚ (Protected) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

When access token expires:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Client    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 1. POST /refresh
       â”‚    Cookie: refresh_token
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Refresh Handler                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ 1. Extract refresh from cookie     â”‚ â”‚
â”‚  â”‚ 2. Validate signature              â”‚ â”‚
â”‚  â”‚ 3. Check session in DB             â”‚ â”‚
â”‚  â”‚ 4. Generate new access token       â”‚ â”‚
â”‚  â”‚ 5. Optionally rotate refresh       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 2. Response: {access_token}
       â”‚    Set-Cookie: new refresh_token
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Client    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Session Management
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 Session Table                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (UUID)                                       â”‚
â”‚ user_id (UUID)                                  â”‚
â”‚ refresh_token_hash (bcrypt)                     â”‚
â”‚ ip_address (string)                             â”‚
â”‚ user_agent (string)                             â”‚
â”‚ device_type (mobile/desktop/tablet)             â”‚
â”‚ browser (Chrome, Firefox, etc.)                 â”‚
â”‚ os (Windows, macOS, iOS, Android)               â”‚
â”‚ country (from IP)                               â”‚
â”‚ city (from IP)                                  â”‚
â”‚ last_active_at (timestamp)                      â”‚
â”‚ expires_at (timestamp)                          â”‚
â”‚ is_active (boolean)                             â”‚
â”‚ created_at (timestamp)                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Cleanup: ĞºĞ°Ğ¶Ğ´Ñ‹Ğ¹ Ñ‡Ğ°Ñ ÑƒĞ´Ğ°Ğ»ÑÑÑ‚ÑÑ expired sessions
```

### Security Tracking
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Login Attempts Table                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (UUID)                                       â”‚
â”‚ email (string)                                  â”‚
â”‚ ip_address (string)                             â”‚
â”‚ user_agent (string)                             â”‚
â”‚ success (boolean)                               â”‚
â”‚ failure_reason (string)                         â”‚
â”‚ created_at (timestamp)                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Redis Tracking:
- login_attempts:{email} â†’ count (TTL: 15min)
- ip_blocked:{ip} â†’ true (TTL: 30min)
- account_locked:{email} â†’ true (TTL: 15min)
```

---

## ğŸ”’ Ğ‘ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚ÑŒ

### Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¼ĞµÑ€Ñ‹

#### 1. Password Security
```
- Minimum: 8 ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ğ¾Ğ²
- Ğ¢Ñ€ĞµĞ±Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ: Ğ±ÑƒĞºĞ²Ñ‹ + Ñ†Ğ¸Ñ„Ñ€Ñ‹
- Bcrypt hashing (cost: 10)
- Ğ—Ğ°Ñ‰Ğ¸Ñ‚Ğ° Ğ¾Ñ‚ rainbow tables
- Ğ—Ğ°Ñ‰Ğ¸Ñ‚Ğ° Ğ¾Ñ‚ timing attacks
```

#### 2. Token Security
```
JWT Access Token:
- Algorithm: HS256
- Expiry: 15 Ğ¼Ğ¸Ğ½ÑƒÑ‚
- Claims: user_id, username, email, role, exp, iat
- Secret: 32+ Ğ±Ğ°Ğ¹Ñ‚ random (Ğ² .env)

JWT Refresh Token:
- Algorithm: HS256
- Expiry: 7 Ğ´Ğ½ĞµĞ¹
- Only in HttpOnly cookie
- Rotation Ğ¿Ñ€Ğ¸ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ¼ refresh
- Ğ¥ĞµÑˆ Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑÑ Ğ² Ğ‘Ğ” Ğ´Ğ»Ñ Ğ¾Ñ‚Ğ·Ñ‹Ğ²Ğ°
```

#### 3. OAuth Security
```
- State token (CSRF Ğ·Ğ°Ñ‰Ğ¸Ñ‚Ğ°)
- Token stored in Redis (short TTL)
- PKCE flow (Ğ´Ğ»Ñ mobile - Ğ±ÑƒĞ´ÑƒÑ‰ĞµĞµ)
- Scope validation
- Provider token verification
- Secure account linking flow
```

#### 4. 2FA Security
```
TOTP:
- RFC 6238 compliant
- 30-second window
- Secret encrypted (AES-256-GCM)
- Time drift tolerance: Â±1 period

Email/SMS:
- 6-digit codes
- Redis storage (TTL: 10min)
- Rate limited (3 codes/hour)
- One-time use
```

#### 5. Rate Limiting
```yaml
Auth endpoints:
  - 5 requests/minute per email
  - 20 requests/minute per IP

General API:
  - 100 requests/minute per user
  - 500 requests/minute per IP

OAuth:
  - 10 auth attempts/hour per IP
```

#### 6. Encryption
```
TOTP Secrets:
- Algorithm: AES-256-GCM
- Key: 32 bytes from ENCRYPTION_KEY env
- Unique IV Ğ´Ğ»Ñ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ³Ğ¾ secret
- Authentication tag Ğ´Ğ»Ñ integrity

Passwords:
- Algorithm: Bcrypt
- Cost factor: 10
- Salt: Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸
```

#### 7. Input Validation
```go
// ĞŸÑ€Ğ¸Ğ¼ĞµÑ€ Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ğ¸
type RegisterRequest struct {
  Username string `validate:"required,min=3,max=50,alphanum"`
  Email    string `validate:"required,email"`
  Password string `validate:"required,min=8"`
}

// Custom validators
func ValidatePassword(password string) (bool, string) {
  if len(password) < 8 {
    return false, "Min 8 characters"
  }
  hasLetter := regexp.MustCompile(`[a-zA-Z]`).MatchString(password)
  hasNumber := regexp.MustCompile(`[0-9]`).MatchString(password)
  if !hasLetter || !hasNumber {
    return false, "Must contain letters and numbers"
  }
  return true, ""
}
```

---

## âœ¨ Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğµ ÑƒĞ»ÑƒÑ‡ÑˆĞµĞ½Ğ¸Ñ

### 1. Apple JWT Signature Verification
```go
// custom-backend/pkg/utils/apple_jwt_verify.go

func VerifyAppleIDToken(idToken string) (*AppleIDTokenClaims, error) {
  // 1. Decode JWT header
  parts := strings.Split(idToken, ".")
  header := decodeBase64(parts[0])
  
  // 2. Extract kid (Key ID)
  var headerData map[string]interface{}
  json.Unmarshal(header, &headerData)
  kid := headerData["kid"].(string)
  
  // 3. Fetch Apple's public keys
  resp, _ := http.Get("https://appleid.apple.com/auth/keys")
  var jwks AppleJWKS
  json.NewDecoder(resp.Body).Decode(&jwks)
  
  // 4. Find matching key
  var publicKey *rsa.PublicKey
  for _, key := range jwks.Keys {
    if key.Kid == kid {
      publicKey = parseRSAPublicKey(key)
      break
    }
  }
  
  // 5. Verify signature
  token, err := jwt.Parse(idToken, func(token *jwt.Token) (interface{}, error) {
    return publicKey, nil
  })
  
  // 6. Validate claims
  claims := token.Claims.(jwt.MapClaims)
  validateIssuer(claims["iss"]) // Must be "https://appleid.apple.com"
  validateAudience(claims["aud"]) // Must be our client ID
  validateExpiry(claims["exp"])
  
  return &AppleIDTokenClaims{
    Sub:   claims["sub"].(string),
    Email: claims["email"].(string),
    // ...
  }, nil
}
```

### 2. OAuth Audit Logging
```go
// custom-backend/internal/models/audit_log.go

type OAuthAuditLog struct {
  ID           uuid.UUID
  UserID       uuid.UUID
  Action       string // "oauth_login", "oauth_link", "oauth_unlink"
  Provider     string // "google", "apple"
  ProviderID   string
  IPAddress    string
  UserAgent    string
  Success      bool
  FailureReason string
  Metadata     string // JSON
  CreatedAt    time.Time
}

// Ğ›Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ²ÑĞµÑ… OAuth ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğ¹
func (h *OAuthHandler) logOAuthEvent(action string, userID uuid.UUID, success bool, metadata map[string]interface{}) {
  metadataJSON, _ := json.Marshal(metadata)
  
  log := OAuthAuditLog{
    ID:         uuid.New(),
    UserID:     userID,
    Action:     action,
    Provider:   metadata["provider"].(string),
    IPAddress:  getClientIP(c),
    UserAgent:  c.Get("User-Agent"),
    Success:    success,
    Metadata:   string(metadataJSON),
    CreatedAt:  time.Now(),
  }
  
  h.db.DB.Create(&log)
  
  // Ğ¢Ğ°ĞºĞ¶Ğµ Ğ»Ğ¾Ğ³Ğ¸Ñ€ÑƒĞµĞ¼ Ğ² stdout Ğ´Ğ»Ñ Ğ¼Ğ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³Ğ°
  log.Printf("[OAuth Audit] action=%s user_id=%s provider=%s success=%v", 
    action, userID, metadata["provider"], success)
}
```

### 3. Email Notifications Ğ´Ğ»Ñ OAuth ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğ¹
```go
// custom-backend/pkg/email/oauth_notifications.go

func (c *SESClient) SendOAuthLinkedEmail(toEmail, provider string) error {
  subject := "OAuth Provider Linked to Your Account"
  
  htmlBody := fmt.Sprintf(`
    <h2>OAuth Provider Linked</h2>
    <p>A %s account has been linked to your account.</p>
    <p>If this wasn't you, please contact support immediately.</p>
    <p>Time: %s</p>
    <hr>
    <p><small>This is an automated security notification.</small></p>
  `, provider, time.Now().Format("2006-01-02 15:04:05"))
  
  return c.Send(toEmail, subject, htmlBody, "")
}

func (c *SESClient) SendOAuthUnlinkedEmail(toEmail, provider string) error {
  subject := "OAuth Provider Removed from Your Account"
  // Similar template...
}

// Ğ’ oauth_handlers.go
func (h *OAuthHandler) ConfirmOAuthLinking(c *fiber.Ctx) error {
  // ... ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‰Ğ¸Ğ¹ ĞºĞ¾Ğ´ ...
  
  // ĞŸĞ¾ÑĞ»Ğµ ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾Ğ³Ğ¾ ÑĞ²ÑĞ·Ñ‹Ğ²Ğ°Ğ½Ğ¸Ñ
  if h.emailClient != nil {
    go h.emailClient.SendOAuthLinkedEmail(user.Email, provider)
  }
  
  // Audit log
  h.logOAuthEvent("oauth_link_confirmed", user.ID, true, map[string]interface{}{
    "provider": provider,
    "method": "password_confirmation",
  })
  
  return c.JSON(...)
}
```

### 4. Security Headers Middleware
```go
// custom-backend/pkg/middleware/security.go

func SecurityHeaders() fiber.Handler {
  return func(c *fiber.Ctx) error {
    // Prevent clickjacking
    c.Set("X-Frame-Options", "DENY")
    
    // Prevent MIME type sniffing
    c.Set("X-Content-Type-Options", "nosniff")
    
    // XSS Protection (legacy, Ğ½Ğ¾ Ğ½Ğµ Ğ¿Ğ¾Ğ¼ĞµÑˆĞ°ĞµÑ‚)
    c.Set("X-XSS-Protection", "1; mode=block")
    
    // HTTPS only
    if os.Getenv("ENV") == "production" {
      c.Set("Strict-Transport-Security", "max-age=31536000; includeSubDomains")
    }
    
    // Content Security Policy
    c.Set("Content-Security-Policy", 
      "default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'")
    
    // Referrer Policy
    c.Set("Referrer-Policy", "strict-origin-when-cross-origin")
    
    // Permissions Policy
    c.Set("Permissions-Policy", "geolocation=(), microphone=(), camera=()")
    
    return c.Next()
  }
}

// Ğ’ main.go
app.Use(middleware.SecurityHeaders())
```

### 5. Enhanced Session Security
```go
// IP and Device fingerprinting
func (s *SessionService) CreateSession(userID uuid.UUID, c *fiber.Ctx, ...) (*models.Session, error) {
  // Existing fields
  ipAddress := getClientIP(c)
  userAgent := c.Get("User-Agent")
  
  // NEW: Device fingerprinting
  deviceInfo := parseUserAgent(userAgent)
  geoInfo := lookupGeoIP(ipAddress)
  
  session := &models.Session{
    UserID:            userID,
    IPAddress:         ipAddress,
    UserAgent:         userAgent,
    DeviceType:        deviceInfo.DeviceType,   // NEW
    Browser:           deviceInfo.Browser,       // NEW
    OS:                deviceInfo.OS,           // NEW
    Country:           geoInfo.Country,         // NEW
    City:              geoInfo.City,            // NEW
    RefreshTokenHash:  refreshTokenHash,
    ExpiresAt:         expiresAt,
    IsActive:          true,
  }
  
  // Suspicious activity detection
  if s.detectSuspiciousActivity(userID, session) {
    // ĞÑ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ° ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ñ Ğ¾ Ğ¿Ğ¾Ğ´Ğ¾Ğ·Ñ€Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾Ğ¹ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚Ğ¸
    go s.emailClient.SendSuspiciousActivityEmail(user.Email, session)
  }
  
  return s.db.Create(session).Error
}

func (s *SessionService) detectSuspiciousActivity(userID uuid.UUID, newSession *models.Session) bool {
  // ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğµ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ğµ ÑĞµÑÑĞ¸Ğ¸
  var recentSessions []models.Session
  s.db.Where("user_id = ? AND is_active = true", userID).
       Order("created_at DESC").
       Limit(5).
       Find(&recentSessions)
  
  for _, session := range recentSessions {
    // ĞĞ¾Ğ²Ğ°Ñ ÑÑ‚Ñ€Ğ°Ğ½Ğ°?
    if session.Country != "" && newSession.Country != session.Country {
      return true
    }
    
    // ĞĞ¾Ğ²Ñ‹Ğ¹ Ñ‚Ğ¸Ğ¿ ÑƒÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ²Ğ°?
    if session.DeviceType != "" && newSession.DeviceType != session.DeviceType {
      return true
    }
    
    // ĞĞ¾Ğ²Ğ°Ñ ĞĞ¡?
    if session.OS != "" && newSession.OS != session.OS {
      return true
    }
  }
  
  return false
}
```

---

## ğŸ§© ĞšĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹

### Backend Components

#### 1. Auth Handler
**Ğ¤Ğ°Ğ¹Ğ»:** `custom-backend/internal/api/auth.go`
**ĞÑ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾ÑÑ‚ÑŒ:** Email/Password Ğ°ÑƒÑ‚ĞµĞ½Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ñ

**Endpoints:**
- `POST /api/auth/register` - Ğ ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ
- `POST /api/auth/login` - Ğ’Ñ…Ğ¾Ğ´
- `POST /api/auth/login/2fa` - Ğ’Ñ…Ğ¾Ğ´ Ñ 2FA
- `POST /api/auth/refresh` - ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ñ‚Ğ¾ĞºĞµĞ½Ğ¾Ğ²
- `POST /api/auth/logout` - Ğ’Ñ‹Ñ…Ğ¾Ğ´
- `POST /api/auth/verify/email` - Ğ’ĞµÑ€Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ñ email
- `POST /api/auth/password/reset` - Ğ—Ğ°Ğ¿Ñ€Ğ¾Ñ ÑĞ±Ñ€Ğ¾ÑĞ° Ğ¿Ğ°Ñ€Ğ¾Ğ»Ñ
- `POST /api/auth/password/reset/confirm` - ĞŸĞ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ¶Ğ´ĞµĞ½Ğ¸Ğµ ÑĞ±Ñ€Ğ¾ÑĞ°
- `POST /api/auth/password/change` - Ğ˜Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğµ Ğ¿Ğ°Ñ€Ğ¾Ğ»Ñ (TOTP protected)
- `GET /api/auth/sessions` - Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº ÑĞµÑÑĞ¸Ğ¹
- `DELETE /api/auth/sessions/:id` - Ğ£Ğ´Ğ°Ğ»ĞµĞ½Ğ¸Ğµ ÑĞµÑÑĞ¸Ğ¸

#### 2. OAuth Handler
**Ğ¤Ğ°Ğ¹Ğ»:** `custom-backend/internal/api/oauth_handlers.go`
**ĞÑ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾ÑÑ‚ÑŒ:** OAuth 2.0 Ğ°ÑƒÑ‚ĞµĞ½Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ñ

**Endpoints:**
- `GET /api/auth/google` - Ğ˜Ğ½Ğ¸Ñ†Ğ¸Ğ°Ñ†Ğ¸Ñ Google OAuth
- `GET /api/auth/google/callback` - Callback Ğ¾Ñ‚ Google
- `GET /api/auth/apple` - Ğ˜Ğ½Ğ¸Ñ†Ğ¸Ğ°Ñ†Ğ¸Ñ Apple Sign In
- `POST /api/auth/apple/callback` - Callback Ğ¾Ñ‚ Apple
- `POST /api/auth/oauth/link/confirm` - ĞŸĞ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ¶Ğ´ĞµĞ½Ğ¸Ğµ ÑĞ²ÑĞ·Ñ‹Ğ²Ğ°Ğ½Ğ¸Ñ
- `POST /api/auth/oauth/set-password` - Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ° Ğ¿Ğ°Ñ€Ğ¾Ğ»Ñ
- `POST /api/auth/oauth/unlink` - ĞÑ‚Ğ²ÑĞ·ĞºĞ° OAuth
- `GET /api/auth/oauth/status` - Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ OAuth

#### 3. TOTP Handler
**Ğ¤Ğ°Ğ¹Ğ»:** `custom-backend/internal/api/totp_handlers.go`
**ĞÑ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾ÑÑ‚ÑŒ:** TOTP 2FA

**Endpoints:**
- `POST /api/totp/generate` - Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ secret
- `POST /api/totp/enable` - Ğ’ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ TOTP
- `POST /api/totp/disable` - ĞÑ‚ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ TOTP
- `POST /api/totp/verify` - ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° ĞºĞ¾Ğ´Ğ°
- `GET /api/totp/status` - Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ TOTP
- `POST /api/totp/backup-codes/regenerate` - ĞĞ¾Ğ²Ñ‹Ğµ backup ĞºĞ¾Ğ´Ñ‹

#### 4. Security Service
**Ğ¤Ğ°Ğ¹Ğ»:** `custom-backend/internal/services/security.go`
**ĞÑ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾ÑÑ‚ÑŒ:** Ğ‘ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚ÑŒ

**Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ğ¸:**
- Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ verification ĞºĞ¾Ğ´Ğ¾Ğ²
- ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° ĞºĞ¾Ğ´Ğ¾Ğ²
- Ğ‘Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²ĞºĞ° IP/Ğ°ĞºĞºĞ°ÑƒĞ½Ñ‚Ğ¾Ğ²
- Ğ›Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¿Ğ¾Ğ¿Ñ‹Ñ‚Ğ¾Ğº Ğ²Ñ…Ğ¾Ğ´Ğ°
- TOTP Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ
- Backup codes ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ

#### 5. Session Service
**Ğ¤Ğ°Ğ¹Ğ»:** `custom-backend/internal/services/session.go`
**ĞÑ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾ÑÑ‚ÑŒ:** Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ÑĞµÑÑĞ¸ÑĞ¼Ğ¸

**Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ğ¸:**
- Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ ÑĞµÑÑĞ¸Ğ¹
- ĞŸĞ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğµ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ñ… ÑĞµÑÑĞ¸Ğ¹
- ĞÑ‚Ğ·Ñ‹Ğ² ÑĞµÑÑĞ¸Ğ¹
- Ğ”ĞµÑ‚ĞµĞºÑ†Ğ¸Ñ Ğ¿Ğ¾Ğ´Ğ¾Ğ·Ñ€Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾Ğ¹ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚Ğ¸
- Cleanup expired sessions

### Frontend Components

#### 1. LoginModal
**Ğ¤Ğ°Ğ¹Ğ»:** `client/components/auth/LoginModal.tsx`
**ĞÑ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾ÑÑ‚ÑŒ:** UI Ğ²Ñ…Ğ¾Ğ´Ğ°

**Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ğ¸:**
- Email/Password Ñ„Ğ¾Ñ€Ğ¼Ğ°
- OAuth ĞºĞ½Ğ¾Ğ¿ĞºĞ¸ (Google/Apple)
- 2FA ĞºĞ¾Ğ´ Ğ²Ğ²Ğ¾Ğ´
- Forgot password link
- ĞŸĞµÑ€ĞµĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ Ğ½Ğ° Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ

#### 2. SignUpModal
**Ğ¤Ğ°Ğ¹Ğ»:** `client/components/auth/SignUpModal.tsx`
**ĞÑ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾ÑÑ‚ÑŒ:** UI Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ğ¸

**Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ğ¸:**
- Username/Email/Password Ñ„Ğ¾Ñ€Ğ¼Ğ°
- Password strength indicator
- OAuth ĞºĞ½Ğ¾Ğ¿ĞºĞ¸
- Email verification Ğ¿Ğ¾ÑĞ»Ğµ Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ğ¸
- ĞŸĞµÑ€ĞµĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ Ğ½Ğ° Ğ²Ñ…Ğ¾Ğ´

#### 3. VerificationModal
**Ğ¤Ğ°Ğ¹Ğ»:** `client/components/auth/VerificationModal.tsx`
**ĞÑ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾ÑÑ‚ÑŒ:** Email/2FA verification

**Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ğ¸:**
- 6-digit code Ğ²Ğ²Ğ¾Ğ´
- Resend code
- Timer countdown
- Auto-submit Ğ¿Ñ€Ğ¸ Ğ·Ğ°Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ğ¸

#### 4. Auth Context
**Ğ¤Ğ°Ğ¹Ğ»:** `client/contexts/AuthContext.tsx`
**ĞÑ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾ÑÑ‚ÑŒ:** State management

**State:**
```typescript
{
  user: User | null,
  isAuthenticated: boolean,
  isLoading: boolean,
  accessToken: string | null,
  login: (email, password) => Promise<void>,
  register: (username, email, password) => Promise<void>,
  logout: () => Promise<void>,
  refreshToken: () => Promise<void>,
  oauthLogin: (provider) => void
}
```

---

## ğŸ“¡ API Endpoints

### ĞŸÑƒĞ±Ğ»Ğ¸Ñ‡Ğ½Ñ‹Ğµ (Ğ±ĞµĞ· Ğ°ÑƒÑ‚ĞµĞ½Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ğ¸)

#### Authentication
```
POST   /api/auth/register
POST   /api/auth/login
POST   /api/auth/login/2fa
POST   /api/auth/refresh
POST   /api/auth/password/reset
POST   /api/auth/password/reset/confirm
POST   /api/auth/oauth/link/confirm
```

#### OAuth
```
GET    /api/auth/google
GET    /api/auth/google/callback
GET    /api/auth/apple
POST   /api/auth/apple/callback
```

### Ğ—Ğ°Ñ‰Ğ¸Ñ‰ĞµĞ½Ğ½Ñ‹Ğµ (Ñ‚Ñ€ĞµĞ±ÑƒÑÑ‚ JWT)

#### Account Management
```
POST   /api/auth/logout
POST   /api/auth/verify/email
POST   /api/auth/resend-verification
GET    /api/auth/sessions
DELETE /api/auth/sessions/:id
GET    /api/auth/2fa/settings
POST   /api/auth/2fa/enable
POST   /api/auth/2fa/confirm
POST   /api/auth/2fa/disable
POST   /api/auth/backup-contact
GET    /api/auth/oauth/status
POST   /api/auth/oauth/set-password
POST   /api/auth/oauth/unlink
```

#### TOTP Protected Operations
```
POST   /api/auth/password/change
POST   /api/users/email/change
POST   /api/users/phone/change
```

#### TOTP Management
```
POST   /api/totp/generate
POST   /api/totp/enable
POST   /api/totp/disable
POST   /api/totp/verify
GET    /api/totp/status
POST   /api/totp/backup-codes/regenerate
```

#### Account Deletion (TOTP Optional)
```
POST   /api/auth/delete-account
POST   /api/account/deactivate
POST   /api/account/restore
GET    /api/account/recovery-info
```

---

## ğŸ—„ï¸ Ğ‘Ğ°Ğ·Ğ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…

### Users Table
```sql
CREATE TABLE users (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  username VARCHAR(50) UNIQUE NOT NULL,
  email VARCHAR(255) UNIQUE NOT NULL,
  password VARCHAR(255), -- Nullable Ğ´Ğ»Ñ OAuth users
  
  -- Profile
  first_name VARCHAR(50),
  last_name VARCHAR(50),
  display_name VARCHAR(100),
  bio TEXT,
  location VARCHAR(100),
  website VARCHAR(255),
  role VARCHAR(100),
  avatar_url VARCHAR(500),
  header_url VARCHAR(500),
  
  -- OAuth
  oauth_provider VARCHAR(50), -- 'google', 'apple', ''
  oauth_provider_id VARCHAR(255),
  
  -- Verification
  is_email_verified BOOLEAN DEFAULT false,
  is_phone_verified BOOLEAN DEFAULT false,
  email_verified_at TIMESTAMP,
  phone_verified_at TIMESTAMP,
  
  -- 2FA
  is_2fa_enabled BOOLEAN DEFAULT false,
  verification_method VARCHAR(10) DEFAULT 'email', -- 'email' or 'sms'
  totp_secret VARCHAR(255), -- Encrypted
  totp_enabled BOOLEAN DEFAULT false,
  
  -- Security
  backup_email VARCHAR(255),
  backup_phone VARCHAR(20),
  phone VARCHAR(20),
  
  -- Account Status
  is_deleted BOOLEAN DEFAULT false,
  deletion_requested_at TIMESTAMP,
  deactivated_at TIMESTAMP,
  deletion_scheduled_at TIMESTAMP,
  
  -- Username Changes
  username_changes_count INT DEFAULT 0,
  last_username_change_at TIMESTAMP,
  
  -- Stats
  followers_count INT DEFAULT 0,
  following_count INT DEFAULT 0,
  posts_count INT DEFAULT 0,
  
  -- Timestamps
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  last_active_at TIMESTAMP,
  
  CONSTRAINT unique_email UNIQUE (email),
  CONSTRAINT unique_username UNIQUE (username)
);

CREATE INDEX idx_users_email ON users(email);
CREATE INDEX idx_users_oauth ON users(oauth_provider, oauth_provider_id);
```

### Sessions Table
```sql
CREATE TABLE sessions (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
  refresh_token_hash VARCHAR(255) NOT NULL,
  
  -- Device Info
  ip_address VARCHAR(45),
  user_agent TEXT,
  device_type VARCHAR(20), -- 'mobile', 'desktop', 'tablet'
  browser VARCHAR(50),
  os VARCHAR(50),
  
  -- Geo Info
  country VARCHAR(100),
  city VARCHAR(100),
  
  -- Status
  is_active BOOLEAN DEFAULT true,
  last_active_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  expires_at TIMESTAMP NOT NULL,
  
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  
  CONSTRAINT fk_user FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
);

CREATE INDEX idx_sessions_user ON sessions(user_id);
CREATE INDEX idx_sessions_expires ON sessions(expires_at);
```

### Login Attempts Table
```sql
CREATE TABLE login_attempts (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  email VARCHAR(255) NOT NULL,
  ip_address VARCHAR(45) NOT NULL,
  user_agent TEXT,
  success BOOLEAN NOT NULL,
  failure_reason VARCHAR(100), -- 'wrong_password', 'user_not_found', etc.
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_login_attempts_email ON login_attempts(email, created_at);
CREATE INDEX idx_login_attempts_ip ON login_attempts(ip_address, created_at);
```

### Verification Codes Table
```sql
CREATE TABLE verification_codes (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
  code VARCHAR(10) NOT NULL,
  type VARCHAR(50) NOT NULL, -- 'email', '2fa', 'password_reset'
  method VARCHAR(10) NOT NULL, -- 'email', 'sms'
  used BOOLEAN DEFAULT false,
  expires_at TIMESTAMP NOT NULL,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  
  CONSTRAINT fk_user FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
);

CREATE INDEX idx_verification_user ON verification_codes(user_id, type);
CREATE INDEX idx_verification_expires ON verification_codes(expires_at);
```

### TOTP Backup Codes Table
```sql
CREATE TABLE totp_backup_codes (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
  code_hash VARCHAR(255) NOT NULL, -- Bcrypt hash
  used BOOLEAN DEFAULT false,
  used_at TIMESTAMP,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  
  CONSTRAINT fk_user FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
);

CREATE INDEX idx_backup_codes_user ON totp_backup_codes(user_id);
```

### OAuth Audit Log Table (NEW)
```sql
CREATE TABLE oauth_audit_logs (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES users(id) ON DELETE SET NULL,
  action VARCHAR(50) NOT NULL, -- 'oauth_login', 'oauth_link', 'oauth_unlink'
  provider VARCHAR(50) NOT NULL, -- 'google', 'apple'
  provider_id VARCHAR(255),
  ip_address VARCHAR(45),
  user_agent TEXT,
  success BOOLEAN NOT NULL,
  failure_reason VARCHAR(255),
  metadata JSONB, -- Additional context
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_oauth_audit_user ON oauth_audit_logs(user_id, created_at);
CREATE INDEX idx_oauth_audit_action ON oauth_audit_logs(action, created_at);
```

---

## ğŸ” Ğ ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ğ¸ Ğ´Ğ»Ñ Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ°

### Ğ§Ñ‚Ğ¾ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚ Ñ…Ğ¾Ñ€Ğ¾ÑˆĞ¾

âœ… **Multi-factor Authentication**
- TOTP Ñ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ñ‹Ğ¼ ÑˆĞ¸Ñ„Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸ĞµĞ¼
- Backup codes Ñ bcrypt
- Email 2FA ĞºĞ¾Ğ´Ñ‹
- Protected operations

âœ… **OAuth Security**
- Secure account linking flow
- State tokens Ğ´Ğ»Ñ CSRF
- Password requirement check
- Cannot unlink without alternative auth

âœ… **Session Management**
- HttpOnly cookies
- Refresh token rotation
- Device fingerprinting
- Suspicious activity detection

âœ… **Rate Limiting**
- Per-email limits
- Per-IP limits
- Account lockouts
- IP blocking

âœ… **Password Security**
- Bcrypt with cost 10
- Strength validation
- Length requirements
- Character requirements

### ĞŸĞ¾Ñ‚ĞµĞ½Ñ†Ğ¸Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ ÑƒĞ»ÑƒÑ‡ÑˆĞµĞ½Ğ¸Ñ

ğŸ”¶ **1. Apple JWT Verification**
**Ğ¢ĞµĞºÑƒÑ‰ĞµĞµ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ:** Ğ£Ğ¿Ñ€Ğ¾Ñ‰ĞµĞ½Ğ½Ğ°Ñ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ°
**Ğ ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ñ:** ĞŸĞ¾Ğ»Ğ½Ğ°Ñ Ğ²ĞµÑ€Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ñ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞ¸ Ñ Apple's public keys
**ĞŸÑ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚:** Ğ¡Ñ€ĞµĞ´Ğ½Ğ¸Ğ¹
**ĞšĞ¾Ğ´:** Ğ¡Ğ¼. Ñ€Ğ°Ğ·Ğ´ĞµĞ» "Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğµ ÑƒĞ»ÑƒÑ‡ÑˆĞµĞ½Ğ¸Ñ #1"

ğŸ”¶ **2. OAuth Audit Logging**
**Ğ¢ĞµĞºÑƒÑ‰ĞµĞµ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ:** Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ stdout Ğ»Ğ¾Ğ³Ğ¸
**Ğ ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ñ:** Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ¾Ğµ Ğ»Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ² Ğ‘Ğ”
**ĞŸÑ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚:** Ğ¡Ñ€ĞµĞ´Ğ½Ğ¸Ğ¹  
**ĞšĞ¾Ğ´:** Ğ¡Ğ¼. Ñ€Ğ°Ğ·Ğ´ĞµĞ» "Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğµ ÑƒĞ»ÑƒÑ‡ÑˆĞµĞ½Ğ¸Ñ #2"

ğŸ”¶ **3. Email Notifications**
**Ğ¢ĞµĞºÑƒÑ‰ĞµĞµ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ:** ĞĞµÑ‚ ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğ¹ Ğ¾ OAuth ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸ÑÑ…
**Ğ ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ñ:** ĞÑ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ° email Ğ¿Ñ€Ğ¸ ÑĞ²ÑĞ·Ñ‹Ğ²Ğ°Ğ½Ğ¸Ğ¸/Ğ¾Ñ‚Ğ²ÑĞ·ĞºĞµ OAuth
**ĞŸÑ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚:** Ğ¡Ñ€ĞµĞ´Ğ½Ğ¸Ğ¹
**ĞšĞ¾Ğ´:** Ğ¡Ğ¼. Ñ€Ğ°Ğ·Ğ´ĞµĞ» "Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğµ ÑƒĞ»ÑƒÑ‡ÑˆĞµĞ½Ğ¸Ñ #3"

ğŸ”¶ **4. Security Headers**
**Ğ¢ĞµĞºÑƒÑ‰ĞµĞµ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ:** Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ CORS
**Ğ ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ñ:** ĞŸĞ¾Ğ»Ğ½Ñ‹Ğ¹ Ğ½Ğ°Ğ±Ğ¾Ñ€ security headers
**ĞŸÑ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚:** Ğ’Ñ‹ÑĞ¾ĞºĞ¸Ğ¹
**ĞšĞ¾Ğ´:** Ğ¡Ğ¼. Ñ€Ğ°Ğ·Ğ´ĞµĞ» "Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğµ ÑƒĞ»ÑƒÑ‡ÑˆĞµĞ½Ğ¸Ñ #4"

ğŸ”¶ **5. Enhanced Session Security**
**Ğ¢ĞµĞºÑƒÑ‰ĞµĞµ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ:** Ğ‘Ğ°Ğ·Ğ¾Ğ²Ñ‹Ğ¹ tracking
**Ğ ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ñ:** Device fingerprinting + geo tracking
**ĞŸÑ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚:** Ğ¡Ñ€ĞµĞ´Ğ½Ğ¸Ğ¹
**ĞšĞ¾Ğ´:** Ğ¡Ğ¼. Ñ€Ğ°Ğ·Ğ´ĞµĞ» "Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğµ ÑƒĞ»ÑƒÑ‡ÑˆĞµĞ½Ğ¸Ñ #5"

### Ğ’Ğ¾Ğ¿Ñ€Ğ¾ÑÑ‹ Ğ´Ğ»Ñ ÑƒĞ³Ğ»ÑƒĞ±Ğ»ĞµĞ½Ğ½Ğ¾Ğ³Ğ¾ Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ°

â“ **1. Token Expiry Tuning**
- Access: 15 Ğ¼Ğ¸Ğ½ÑƒÑ‚ - Ğ¾Ğ¿Ñ‚Ğ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ğ¾?
- Refresh: 7 Ğ´Ğ½ĞµĞ¹ - Ğ´Ğ¾ÑÑ‚Ğ°Ñ‚Ğ¾Ñ‡Ğ½Ğ¾ Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾?
- ĞÑƒĞ¶Ğ½Ğ° Ğ»Ğ¸ refresh token rotation?

â“ **2. Rate Limiting Effectiveness**
- Ğ¢ĞµĞºÑƒÑ‰Ğ¸Ğµ Ğ»Ğ¸Ğ¼Ğ¸Ñ‚Ñ‹ Ğ´Ğ¾ÑÑ‚Ğ°Ñ‚Ğ¾Ñ‡Ğ½Ñ‹?
- ĞÑƒĞ¶Ğ½Ñ‹ Ğ»Ğ¸ Ñ€Ğ°Ğ·Ğ½Ñ‹Ğµ Ğ»Ğ¸Ğ¼Ğ¸Ñ‚Ñ‹ Ğ´Ğ»Ñ Ñ€Ğ°Ğ·Ğ½Ñ‹Ñ… endpoint'Ğ¾Ğ²?
- Distributed rate limiting Ğ´Ğ»Ñ Ğ¼Ğ°ÑÑˆÑ‚Ğ°Ğ±Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ?

â“ **3. Password Policy**
- ĞœĞ¸Ğ½Ğ¸Ğ¼ÑƒĞ¼ 8 ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ğ¾Ğ² Ğ´Ğ¾ÑÑ‚Ğ°Ñ‚Ğ¾Ñ‡Ğ½Ğ¾?
- ĞÑƒĞ¶Ğ½Ñ‹ Ğ»Ğ¸ Ñ‚Ñ€ĞµĞ±Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ Ğº ÑĞ¿ĞµÑ†Ğ¸Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¼ ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ğ°Ğ¼?
- Password history (Ğ½Ğµ Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€ÑÑ‚ÑŒ Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğµ N)?
- Password expiration policy?

â“ **4. OAuth Provider Validation**
- Ğ”Ğ¾ÑÑ‚Ğ°Ñ‚Ğ¾Ñ‡Ğ½Ğ¾ Ğ»Ğ¸ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€Ğ¾Ğº email_verified Ğ¾Ñ‚ Ğ¿Ñ€Ğ¾Ğ²Ğ°Ğ¹Ğ´ĞµÑ€Ğ°?
- ĞÑƒĞ¶Ğ½Ğ° Ğ»Ğ¸ Ğ´Ğ¾Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ°Ñ Ğ²ĞµÑ€Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ñ email?
- ĞšĞ°Ğº Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ°Ñ‚Ñ‹Ğ²Ğ°Ñ‚ÑŒ Ñ‡Ğ°ÑÑ‚Ğ½Ñ‹Ğµ Apple email'Ñ‹?

â“ **5. Session Management**
- ĞœĞ°ĞºÑĞ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ğ¾Ğµ ĞºĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ñ… ÑĞµÑÑĞ¸Ğ¹ Ğ½Ğ° Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ?
- Auto-logout Ğ½Ğ° Ğ´Ñ€ÑƒĞ³Ğ¸Ñ… ÑƒÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ²Ğ°Ñ… Ğ¿Ñ€Ğ¸ ÑĞ¼ĞµĞ½Ğµ Ğ¿Ğ°Ñ€Ğ¾Ğ»Ñ?
- Session fixation attack protection?

â“ **6. TOTP Implementation**
- 30-ÑĞµĞºÑƒĞ½Ğ´Ğ½Ğ¾Ğµ Ğ¾ĞºĞ½Ğ¾ Ğ¾Ğ¿Ñ‚Ğ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ğ¾?
- Time drift tolerance Ğ´Ğ¾ÑÑ‚Ğ°Ñ‚Ğ¾Ñ‡ĞµĞ½?
- ĞÑƒĞ¶Ğ½Ğ° Ğ»Ğ¸ Ğ·Ğ°Ñ‰Ğ¸Ñ‚Ğ° Ğ¾Ñ‚ replay attacks?

â“ **7. Backup & Recovery**
- Ğ”Ğ¾ÑÑ‚Ğ°Ñ‚Ğ¾Ñ‡Ğ½Ğ¾ Ğ»Ğ¸ 10 backup ĞºĞ¾Ğ´Ğ¾Ğ²?
- Recovery flow Ğ¿Ñ€Ğ¸ Ğ¿Ğ¾Ñ‚ĞµÑ€Ğµ Ğ²ÑĞµÑ… auth methods?
- Account recovery Ñ‡ĞµÑ€ĞµĞ· support?

â“ **8. Audit & Compliance**
- GDPR compliance (data deletion, portability)?
- Ğ›Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ²ÑĞµÑ… ĞºÑ€Ğ¸Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ñ… Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸Ğ¹?
- Retention policy Ğ´Ğ»Ñ Ğ»Ğ¾Ğ³Ğ¾Ğ²?
- Encryption at rest Ğ´Ğ»Ñ sensitive data?

â“ **9. Mobile Considerations**
- PKCE flow Ğ´Ğ»Ñ mobile OAuth?
- Biometric authentication integration?
- Push notifications Ğ´Ğ»Ñ suspicious activity?
- Mobile-specific session management?

â“ **10. Performance & Scalability**
- Redis caching ÑÑ‚Ñ€Ğ°Ñ‚ĞµĞ³Ğ¸Ñ?
- Database query optimization?
- Horizontal scaling Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ğ½Ğ¾ÑÑ‚ÑŒ?
- Rate limiter distribution?

### ĞœĞµÑ‚Ñ€Ğ¸ĞºĞ¸ Ğ´Ğ»Ñ Ğ¼Ğ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³Ğ°

ğŸ“Š **Authentication Metrics**
```
- Login success rate
- Login failure rate by reason
- Average login time
- 2FA usage rate
- OAuth provider distribution
- Session duration average
- Account lockout rate
- Password reset frequency
```

ğŸ“Š **Security Metrics**
```
- Failed login attempts per hour
- IP blocks per day
- Account lockouts per day
- Suspicious activity detections
- 2FA bypass attempts
- Token expiry before refresh
- Session hijacking attempts
- CSRF token failures
```

ğŸ“Š **Performance Metrics**
```
- JWT generation time
- Token validation time
- Database query time (auth)
- Redis operation time
- Email send time
- OAuth callback time
- TOTP verification time
```

---

## ğŸ¯ Ğ˜Ñ‚Ğ¾Ğ³Ğ¾Ğ²Ñ‹Ğµ Ñ€ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ğ¸

### ĞĞµĞ¼ĞµĞ´Ğ»ĞµĞ½Ğ½Ñ‹Ğµ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ (Critical)

1. âœ… **OAuth Account Linking Security** - Ğ’Ğ«ĞŸĞĞ›ĞĞ•ĞĞ
   - Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¾ Ğ¿Ğ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ¶Ğ´ĞµĞ½Ğ¸Ğµ Ñ‡ĞµÑ€ĞµĞ· Ğ¿Ğ°Ñ€Ğ¾Ğ»ÑŒ
   - Linking token Ñ TTL
   - ĞŸÑ€ĞµĞ´Ğ¾Ñ‚Ğ²Ñ€Ğ°Ñ‰ĞµĞ½Ğ¸Ğµ hijacking

2. âœ… **OAuth Password Management** - Ğ’Ğ«ĞŸĞĞ›ĞĞ•ĞĞ
   - Endpoint Ğ´Ğ»Ñ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ¸ Ğ¿Ğ°Ñ€Ğ¾Ğ»Ñ
   - Endpoint Ğ´Ğ»Ñ Ğ¾Ñ‚Ğ²ÑĞ·ĞºĞ¸ OAuth
   - ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ½Ğ°Ğ»Ğ¸Ñ‡Ğ¸Ñ Ğ°Ğ»ÑŒÑ‚ĞµÑ€Ğ½Ğ°Ñ‚Ğ¸Ğ²Ğ½Ğ¾Ğ³Ğ¾ auth method

3. ğŸ”„ **Security Headers** - Ğ§ĞĞ¡Ğ¢Ğ˜Ğ§ĞĞ
   - Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ¿Ğ¾Ğ»Ğ½Ñ‹Ğ¹ Ğ½Ğ°Ğ±Ğ¾Ñ€ headers
   - CSP policy
   - HSTS Ğ´Ğ»Ñ production

### ĞšÑ€Ğ°Ñ‚ĞºĞ¾ÑÑ€Ğ¾Ñ‡Ğ½Ñ‹Ğµ (1-2 Ğ½ĞµĞ´ĞµĞ»Ğ¸)

1. **Apple JWT Verification**
   - Proper signature validation
   - Public keys caching
   - Claims validation

2. **OAuth Audit Logging**
   - Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ»Ğ¾Ğ³Ğ¸ Ğ² Ğ‘Ğ”
   - Dashboard Ğ´Ğ»Ñ Ğ¼Ğ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³Ğ°
   - Alerts Ğ´Ğ»Ñ suspicious activity

3. **Email Notifications**
   - OAuth linking/unlinking
   - New device login
   - Suspicious activity
   - Password changes

4. **Enhanced Session Security**
   - Device fingerprinting
   - Geo-IP tracking
   - Suspicious activity detection
   - Auto-logout Ğ½Ğ° Ğ´Ñ€ÑƒĞ³Ğ¸Ñ… ÑƒÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ²Ğ°Ñ…

### Ğ¡Ñ€ĞµĞ´Ğ½ĞµÑÑ€Ğ¾Ñ‡Ğ½Ñ‹Ğµ (1-2 Ğ¼ĞµÑÑÑ†Ğ°)

1. **Mobile Support**
   - PKCE flow Ğ´Ğ»Ñ OAuth
   - Push notifications
   - Biometric auth integration
   - Mobile-specific rate limits

2. **Advanced Security**
   - Password history
   - Password expiration
   - Session concurrency limits
   - Advanced fraud detection

3. **Monitoring & Alerting**
   - Comprehensive metrics
   - Real-time dashboards
   - Automated alerts
   - Security incident response

4. **Compliance**
   - GDPR compliance audit
   - Data retention policies
   - Encryption at rest
   - Privacy policy implementation

### Ğ”Ğ¾Ğ»Ğ³Ğ¾ÑÑ€Ğ¾Ñ‡Ğ½Ñ‹Ğµ (3+ Ğ¼ĞµÑÑÑ†Ğ°)

1. **Passwordless Auth**
   - WebAuthn / FIDO2
   - Magic links
   - SMS-based login

2. **Advanced 2FA**
   - Hardware keys (YubiKey)
   - Biometric 2FA
   - Push-based 2FA
   - Adaptive MFA

3. **Zero Trust Architecture**
   - Continuous authentication
   - Context-based access
   - Device trust scoring
   - Behavior analytics

4. **Enterprise Features**
   - SSO (SAML, OIDC)
   - Directory integration (LDAP, AD)
   - Org-level policies
   - Admin controls

---

## ğŸ“š Ğ”Ğ¾Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğµ Ñ€ĞµÑÑƒÑ€ÑÑ‹

### Ğ¡Ñ‚Ğ°Ğ½Ğ´Ğ°Ñ€Ñ‚Ñ‹ Ğ¸ ÑĞ¿ĞµÑ†Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ğ¸
- OAuth 2.0: RFC 6749
- TOTP: RFC 6238
- JWT: RFC 7519
- PKCE: RFC 7636
- WebAuthn: W3C Specification

### Security Best Practices
- OWASP Top 10
- OWASP Authentication Cheat Sheet
- NIST Digital Identity Guidelines
- CIS Security Controls

### Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼Ñ‹Ğµ Ğ±Ğ¸Ğ±Ğ»Ğ¸Ğ¾Ñ‚ĞµĞºĞ¸
- golang-jwt/jwt: https://github.com/golang-jwt/jwt
- golang.org/x/oauth2: https://pkg.go.dev/golang.org/x/oauth2
- pquerna/otp: https://github.com/pquerna/otp
- golang.org/x/crypto: https://pkg.go.dev/golang.org/x/crypto

---

**Ğ”Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚ ÑĞ¾Ğ·Ğ´Ğ°Ğ½:** 2025-11-03
**Ğ’ĞµÑ€ÑĞ¸Ñ:** 1.0.0
**ĞĞ²Ñ‚Ğ¾Ñ€:** Cline AI Assistant
**Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ:** Complete & Production Ready âœ…
