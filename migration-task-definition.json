{
  "family": "tyriantrade-migration",
  "networkMode": "awsvpc",
  "requiresCompatibilities": ["FARGATE"],
  "cpu": "256",
  "memory": "512",
  "executionRoleArn": "arn:aws:iam::506675684508:role/ecsTaskExecutionRole",
  "containerDefinitions": [
    {
      "name": "migration",
      "image": "postgres:15-alpine",
      "essential": true,
      "command": [
        "/bin/sh",
        "-c",
        "apk add --no-cache postgresql-client && PGPASSWORD='kn8wHxZT3P4yVmQs' psql -h tyriantrade-db.c01iqwikc9ht.us-east-1.rds.amazonaws.com -U dbadmin -d tyriantrade -c \"CREATE TABLE IF NOT EXISTS news (id UUID PRIMARY KEY DEFAULT gen_random_uuid(), title VARCHAR(255) NOT NULL, description TEXT, url TEXT, image_url TEXT, category VARCHAR(50), source VARCHAR(100), created_by UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE, is_active BOOLEAN DEFAULT true NOT NULL, published_at TIMESTAMP WITH TIME ZONE NOT NULL, created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP, updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP); CREATE TABLE IF NOT EXISTS verification_codes (id SERIAL PRIMARY KEY, user_id INTEGER NOT NULL REFERENCES users(id) ON DELETE CASCADE, code VARCHAR(10) NOT NULL, type VARCHAR(20) NOT NULL, method VARCHAR(10) NOT NULL, used BOOLEAN DEFAULT FALSE, expires_at TIMESTAMP NOT NULL, created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP); ALTER TABLE users ADD COLUMN IF NOT EXISTS role VARCHAR(20) DEFAULT 'user' NOT NULL;\" && echo 'Migrations applied successfully'"
      ],
      "logConfiguration": {
        "logDriver": "awslogs",
        "options": {
          "awslogs-group": "/ecs/tyriantrade-migration",
          "awslogs-region": "us-east-1",
          "awslogs-stream-prefix": "migration"
        }
      }
    }
  ]
}
