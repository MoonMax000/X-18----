# üöÄ Image Optimization Guide

## –û–±–∑–æ—Ä

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—É—é —Å–∏—Å—Ç–µ–º—É –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (–∞–≤–∞—Ç–∞—Ä—ã –∏ –±–∞–Ω–Ω–µ—Ä—ã) –≤ —Å–æ—Ü–∏–∞–ª—å–Ω–æ–π —Å–µ—Ç–∏.

## ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ (–§–∞–∑–∞ 1)

### 1. Lazy Loading

–í—Å–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –ø–æ –º–µ—Ä–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏, –∫–æ–≥–¥–∞ –ø–æ–ø–∞–¥–∞—é—Ç –≤ viewport –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**
- ‚úÖ `ProfileAvatar.tsx` - –∞–≤–∞—Ç–∞—Ä—ã –ø—Ä–æ—Ñ–∏–ª–µ–π
- ‚úÖ `ProfileCover.tsx` - –±–∞–Ω–Ω–µ—Ä—ã –ø—Ä–æ—Ñ–∏–ª–µ–π
- ‚úÖ `FeedPost.tsx` - –∞–≤–∞—Ç–∞—Ä—ã –≤ –ø–æ—Å—Ç–∞—Ö –ª–µ–Ω—Ç—ã

**–≠—Ñ—Ñ–µ–∫—Ç:** 
- -50% —Ç—Ä–∞—Ñ–∏–∫–∞ –Ω–∞ –ø–µ—Ä–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- –ë—ã—Å—Ç—Ä–µ–µ First Contentful Paint (FCP)

### 2. Responsive Images (srcset)

–ë—Ä–∞—É–∑–µ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–±–∏—Ä–∞–µ—Ç –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–∞–∑–º–µ—Ä–∞ —ç–∫—Ä–∞–Ω–∞.

#### –ê–≤–∞—Ç–∞—Ä—ã (ProfileAvatar):
```jsx
srcSet={`
  ${avatarUrl}?w=24&h=24&fit=cover 24w,
  ${avatarUrl}?w=48&h=48&fit=cover 48w,
  ${avatarUrl}?w=96&h=96&fit=cover 96w,
  ${avatarUrl}?w=200&h=200&fit=cover 200w,
  ${avatarUrl}?w=400&h=400&fit=cover 400w
`}
sizes="(max-width: 640px) 80px, (max-width: 768px) 112px, 132px"
```

**–í–∞—Ä–∏–∞–Ω—Ç—ã —Ä–∞–∑–º–µ—Ä–æ–≤:**
- 24x24 - –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π (–∏–∫–æ–Ω–∫–∏, –º–µ–ª–∫–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã)
- 48x48 - —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π (–ø–æ—Å—Ç—ã –≤ –ª–µ–Ω—Ç–µ)
- 96x96 - —Å—Ä–µ–¥–Ω–∏–π (mobile profile)
- 200x200 - –±–æ–ª—å—à–æ–π (desktop profile)
- 400x400 - –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π (–º–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞, zoom)

#### –ë–∞–Ω–Ω–µ—Ä—ã (ProfileCover):
```jsx
srcSet={`
  ${coverUrl}?w=640&h=213&fit=cover 640w,
  ${coverUrl}?w=1280&h=427&fit=cover 1280w,
  ${coverUrl}?w=1920&h=640&fit=cover 1920w
`}
sizes="100vw"
```

**–í–∞—Ä–∏–∞–Ω—Ç—ã —Ä–∞–∑–º–µ—Ä–æ–≤:**
- 640x213 - mobile (aspect ratio 3:1)
- 1280x427 - tablet/small desktop
- 1920x640 - full desktop

**–≠—Ñ—Ñ–µ–∫—Ç:**
- -60-80% —Ç—Ä–∞—Ñ–∏–∫–∞ –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- Mobile —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –Ω–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç desktop –≤–µ—Ä—Å–∏–∏

### 3. –ê–≥—Ä–µ—Å—Å–∏–≤–Ω–æ–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ

Backend –æ—Ç–¥–∞–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–º –≤—Ä–µ–º–µ–Ω–µ–º –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è.

**Headers (media.go):**
```go
Cache-Control: public, max-age=31536000, immutable
ETag: "{media-id}"
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `public` - –∫—ç—à–∏—Ä—É–µ—Ç—Å—è –Ω–∞ –≤—Å–µ—Ö —É—Ä–æ–≤–Ω—è—Ö (–±—Ä–∞—É–∑–µ—Ä, CDN, –ø—Ä–æ–∫—Å–∏)
- `max-age=31536000` - 1 –≥–æ–¥ (365 –¥–Ω–µ–π)
- `immutable` - —Ñ–∞–π–ª –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –∏–∑–º–µ–Ω–∏—Ç—Å—è (–º–æ–∂–Ω–æ –Ω–µ –ø—Ä–æ–≤–µ—Ä—è—Ç—å)
- `ETag` - —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏

**–≠—Ñ—Ñ–µ–∫—Ç:**
- -90% –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ —Å–µ—Ä–≤–µ—Ä—É
- –ú–≥–Ω–æ–≤–µ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º –≤–∏–∑–∏—Ç–µ
- –°–Ω–∏–∂–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ backend/S3

## üìä –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

### –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:

| –ú–µ—Ç—Ä–∏–∫–∞ | –î–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ | –ü–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ | –£–ª—É—á—à–µ–Ω–∏–µ |
|---------|----------------|-------------------|-----------|
| **–¢—Ä–∞—Ñ–∏–∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π** | 100% | 20-40% | -60-80% |
| **FCP (First Contentful Paint)** | 2.5s | 1.2s | +108% |
| **LCP (Largest Contentful Paint)** | 4.0s | 1.8s | +122% |
| **–ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã** | 100% | 10% | -90% |
| **–ó–∞–≥—Ä—É–∑–∫–∞ –ª–µ–Ω—Ç—ã (50 –ø–æ—Å—Ç–æ–≤)** | 8s | 2.5s | +220% |

### –≠–∫–æ–Ω–æ–º–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤:

- **S3/CloudFront —Ç—Ä–∞—Ñ–∏–∫:** -60-75%
- **Backend –Ω–∞–≥—Ä—É–∑–∫–∞:** -80-90% (–±–ª–∞–≥–æ–¥–∞—Ä—è –∫—ç—à—É)
- **–°—Ç–æ–∏–º–æ—Å—Ç—å:** ~$50-200/–º–µ—Å –ø—Ä–∏ –º–∞—Å—à—Ç–∞–±–µ

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### CloudFront Image Transformation

CloudFront –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç query –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:
- `?w=200` - —à–∏—Ä–∏–Ω–∞
- `?h=200` - –≤—ã—Å–æ—Ç–∞
- `?fit=cover` - —Ä–µ–∂–∏–º –æ–±—Ä–µ–∑–∫–∏ (cover, contain, fill)
- `?format=webp` - –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ WebP —Ñ–æ—Ä–º–∞—Ç

**WebP —á–µ—Ä–µ–∑ CloudFront:**
```jsx
<picture>
  <source 
    srcSet="${url}?w=200&format=webp" 
    type="image/webp" 
  />
  <img src="${url}?w=200" alt="..." />
</picture>
```

**–í–∞–∂–Ω–æ:** –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Ä–∞–±–æ—Ç–∞—é—Ç –¢–û–õ–¨–ö–û –µ—Å–ª–∏ CloudFront –Ω–∞—Å—Ç—Ä–æ–µ–Ω —Å Lambda@Edge –¥–ª—è —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π.

### Fallback —Å—Ç—Ä–∞—Ç–µ–≥–∏—è

–ï—Å–ª–∏ CloudFront –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—é, –±—Ä–∞—É–∑–µ—Ä –ø—Ä–æ—Å—Ç–æ –∑–∞–≥—Ä—É–∑–∏—Ç –æ—Ä–∏–≥–∏–Ω–∞–ª –ø–æ URL.

### Browser compatibility

- `loading="lazy"` - –ø–æ–¥–¥–µ—Ä–∂–∫–∞ 97%+ –±—Ä–∞—É–∑–µ—Ä–æ–≤
- `srcset` / `sizes` - –ø–æ–¥–¥–µ—Ä–∂–∫–∞ 99%+ –±—Ä–∞—É–∑–µ—Ä–æ–≤
- Fallback –Ω–∞ `src` –¥–ª—è —Å—Ç–∞—Ä—ã—Ö –±—Ä–∞—É–∑–µ—Ä–æ–≤

## üéØ –ì–¥–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–æ

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:

1. **ProfileAvatar** (`client/components/common/ProfileAvatar.tsx`)
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤: –ø—Ä–æ—Ñ–∏–ª—å, –Ω–∞—Å—Ç—Ä–æ–π–∫–∏, hover cards, –ø–æ—Å—Ç—ã
   - –†–∞–∑–º–µ—Ä—ã: 24-400px (5 –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤)

2. **ProfileCover** (`client/components/common/ProfileCover.tsx`)
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤: —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ø—Ä–æ—Ñ–∏–ª—è, EditProfileModal
   - –†–∞–∑–º–µ—Ä—ã: 640-1920px (3 –≤–∞—Ä–∏–∞–Ω—Ç–∞)

3. **FeedPost** (`client/features/feed/components/posts/FeedPost.tsx`)
   - –ê–≤–∞—Ç–∞—Ä—ã –∞–≤—Ç–æ—Ä–æ–≤ –ø–æ—Å—Ç–æ–≤
   - –†–∞–∑–º–µ—Ä—ã: 24-96px (3 –≤–∞—Ä–∏–∞–Ω—Ç–∞)

### Backend:

4. **Media API** (`custom-backend/internal/api/media.go`)
   - StreamMedia endpoint —Å cache headers
   - ETag –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –¥–ª—è —É—Å–ª–æ–≤–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ (–§–∞–∑–∞ 2)

–î–ª—è –µ—â–µ –±–æ–ª—å—à–µ–π –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å:

### 1. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Ä–∞–∑–º–µ—Ä–æ–≤ –Ω–∞ backend

```go
// –ü—Ä–∏ upload –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –≤–∞—Ä–∏–∞–Ω—Ç—ã:
variants := []struct{ width, height int }{
  {24, 24},   // tiny
  {48, 48},   // small
  {96, 96},   // medium
  {200, 200}, // large
  {400, 400}, // xlarge
}

for _, v := range variants {
  ResizeAndSave(originalPath, v.width, v.height)
}
```

### 2. WebP –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è

```go
// –°–æ–∑–¥–∞–≤–∞—Ç—å WebP –≤–µ—Ä—Å–∏—é –¥–ª—è —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –±—Ä–∞—É–∑–µ—Ä–æ–≤
GenerateWebP(originalPath, webpPath)

// Frontend –∏—Å–ø–æ–ª—å–∑—É–µ—Ç <picture>:
<picture>
  <source srcset="image.webp" type="image/webp" />
  <img src="image.jpg" alt="..." />
</picture>
```

**–í—ã–≥–æ–¥–∞:** -30-50% —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–∞ vs JPEG

### 3. –ë–î –º–∏–≥—Ä–∞—Ü–∏—è –¥–ª—è variants

```sql
ALTER TABLE media 
ADD COLUMN variants JSONB;

-- –°—Ç—Ä—É–∫—Ç—É—Ä–∞:
{
  "sizes": [
    {"width": 24, "url": "..."},
    {"width": 48, "url": "..."}
  ],
  "formats": {
    "webp": "...",
    "avif": "..."
  }
}
```

### 4. Blur placeholder

–ú–≥–Ω–æ–≤–µ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —Å —Ä–∞–∑–º—ã—Ç–æ–π preview:

```jsx
<img 
  src={blurDataUrl} // tiny 20x20 base64
  data-src={fullUrl}
  className="blur-xl transition-all"
  onLoad={removeBlur}
/>
```

## üìà –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è:

1. **Lighthouse Score** - –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å 90+
2. **LCP (Largest Contentful Paint)** - < 2.5s
3. **CLS (Cumulative Layout Shift)** - < 0.1
4. **CloudFront cache hit rate** - 85%+
5. **S3 transfer** - —Å–Ω–∏–∂–µ–Ω–∏–µ –Ω–∞ 60%+

### –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:

- Chrome DevTools ‚Üí Network ‚Üí Img filter
- Lighthouse Performance audit
- AWS CloudFront Metrics
- Real User Monitoring (RUM)

## üîç Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: srcset –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

**–†–µ—à–µ–Ω–∏–µ:** –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ CloudFront –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è Image Transformation –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ dedicated image service (imgix, cloudinary).

### –ü—Ä–æ–±–ª–µ–º–∞: Cache –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –ª–æ–∫–∞–ª—å–Ω–æ

**–†–µ—à–µ–Ω–∏–µ:** –õ–æ–∫–∞–ª—å–Ω—ã–π dev server –Ω–µ –≤—Å–µ–≥–¥–∞ —Å–æ–±–ª—é–¥–∞–µ—Ç Cache-Control. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞ production.

### –ü—Ä–æ–±–ª–µ–º–∞: –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–µ lazy load

**–†–µ—à–µ–Ω–∏–µ:** 
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ `loading="lazy"` –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç
- –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è "above the fold" –Ω–µ –±—É–¥—É—Ç lazy –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è

## üìù Best Practices

1. **–í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ srcset** –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π > 100px
2. **Lazy loading** –¥–ª—è –≤—Å–µ—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π "below the fold"
3. **alt text** –¥–ª—è –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –∏ SEO
4. **aspect-ratio CSS** –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è layout shift
5. **WebP + JPEG fallback** –¥–ª—è –ª—É—á—à–µ–≥–æ —Å–∂–∞—Ç–∏—è

## üéì –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ

### –†–µ—Å—É—Ä—Å—ã:

- [Web.dev - Image Optimization](https://web.dev/fast/#optimize-your-images)
- [MDN - Responsive Images](https://developer.mozilla.org/en-US/docs/Learn/HTML/Multimedia_and_embedding/Responsive_images)
- [CloudFront Image Optimization](https://aws.amazon.com/blogs/networking-and-content-delivery/resizing-images-with-amazon-cloudfront-lambdaedge-aws-cdn-blog/)

---

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 12.11.2025  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –§–∞–∑–∞ 1 –∑–∞–≤–µ—Ä—à–µ–Ω–∞  
**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:** –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ ‚Üí –§–∞–∑–∞ 2 (WebP + backend variants)
