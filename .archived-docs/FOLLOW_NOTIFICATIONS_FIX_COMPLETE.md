# ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –£–í–ï–î–û–ú–õ–ï–ù–ò–ô –û –ü–û–î–ü–ò–°–ö–ê–• - –ó–ê–í–ï–†–®–ï–ù–û

## üìã –ü—Ä–æ–±–ª–µ–º–∞

–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –ø–æ–¥–ø–∏—Å–∫–∞—Ö –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–ª–∏—Å—å –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ, —Ö–æ—Ç—è backend –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Å–æ–∑–¥–∞–≤–∞–ª –∏—Ö –∏ —Å–æ—Ö—Ä–∞–Ω—è–ª –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.

## üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### Backend (‚úÖ –ë—ã–ª –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º)

**custom-backend/internal/api/users.go - FollowUser():**
```go
notification := models.Notification{
    UserID:     targetUserID,
    Type:       "follow",
    FromUserID: &currentUserID,  // ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ
}
```

**custom-backend/internal/api/notifications.go - GetNotifications():**
```go
Preload("FromUser")  // ‚úÖ –ó–∞–≥—Ä—É–∂–∞–µ—Ç —Å–≤—è–∑–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```

**custom-backend/internal/models/relations.go:**
```go
FromUserID *uuid.UUID `json:"actor_id,omitempty"`
FromUser   *User      `json:"actor,omitempty"`  // ‚úÖ JSON –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç "actor"
```

### Frontend (‚ùå –ë—ã–ª–∞ –ø—Ä–æ–±–ª–µ–º–∞)

**client/pages/SocialNotifications.tsx (—Å—Ç—Ä–æ–∫–∞ 52):**
```typescript
// –î–û –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø:
const actor = (notification as any).from_user || (notification as any).actor;
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –ö–æ–¥ –∏—Å–∫–∞–ª –ø–æ–ª–µ `from_user`, –Ω–æ backend –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–æ–ª—å–∫–æ `actor`!

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

### 1. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω SocialNotifications.tsx

**client/pages/SocialNotifications.tsx:**
```typescript
// –ü–û–°–õ–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø:
function convertNotification(notification: Notification): NotificationItem {
  const { id, type, created_at, post, is_read } = notification;
  // Backend returns actor field with user info
  const actor = notification.actor;  // ‚úÖ –¢–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –ø–æ–ª–µ
  
  // ... –æ—Å—Ç–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞
}
```

### 2. –û–±–Ω–æ–≤–ª–µ–Ω—ã —Ç–∏–ø—ã –≤ custom-backend.ts

**client/services/api/custom-backend.ts:**
```typescript
export interface Notification {
  id: string;
  user_id: string;
  type: 'like' | 'retweet' | 'follow' | 'mention' | 'reply';
  actor_id?: string;
  actor?: User; // Backend returns user info in "actor" field ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π
  post_id?: string;
  post?: Post;
  is_read: boolean;
  created_at: string;
}
```

## üéØ –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å

### –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
- ‚ùå Frontend –∏—Å–∫–∞–ª `from_user` –≤ –æ—Ç–≤–µ—Ç–µ backend
- ‚ùå Backend –≤–æ–∑–≤—Ä–∞—â–∞–ª `actor`
- ‚ùå –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –ø–æ–ª–µ–π ‚Üí —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–ª–∏—Å—å

### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
- ‚úÖ Frontend –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `notification.actor`
- ‚úÖ –°–æ–≤–ø–∞–¥–∞–µ—Ç —Å —Ç–µ–º, —á—Ç–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç backend
- ‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

## üìä –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö

```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å A –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è B
   ‚Üì
2. Backend (users.go):
   - –°–æ–∑–¥–∞–µ—Ç –∑–∞–ø–∏—Å—å Follow
   - –°–æ–∑–¥–∞–µ—Ç Notification —Å FromUserID = A
   - –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ –ë–î
   ‚Üì
3. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å B –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
   ‚Üì
4. Backend (notifications.go):
   - –ó–∞–≥—Ä—É–∂–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
   - Preload("FromUser") ‚Üí –∑–∞–ø–æ–ª–Ω—è–µ—Ç actor
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç JSON: { actor: { username: "A", ... } }
   ‚Üì
5. Frontend (SocialNotifications.tsx):
   - –ü–æ–ª—É—á–∞–µ—Ç notification.actor ‚úÖ
   - –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç –≤ UI —Ñ–æ—Ä–º–∞—Ç
   - –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç: "A –ø–æ–¥–ø–∏—Å–∞–ª—Å—è –Ω–∞ –≤–∞—à–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è"
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
./test-hover-card-follow.sh
```

### –†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:

1. **–°–æ–∑–¥–∞—Ç—å –ø–æ–¥–ø–∏—Å–∫—É:**
   - –í–æ–π—Ç–∏ –ø–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º A
   - –ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è B

2. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å backend –ª–æ–≥–∏:**
   ```bash
   tail -f custom-backend.log | grep -E 'FollowUser|CreateNotification'
   ```
   –î–æ–ª–∂–Ω–æ –±—ã—Ç—å:
   ```
   [FollowUser] ‚úì Follow record created
   [FollowUser] ‚úì Notification created successfully
   ```

3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å frontend:**
   - –í–æ–π—Ç–∏ –ø–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º B
   - –û—Ç–∫—Ä—ã—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π: `/social/notifications`
   - –î–æ–ª–∂–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è: "A –ø–æ–¥–ø–∏—Å–∞–ª—Å—è –Ω–∞ –≤–∞—à–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è"

4. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å console.log:**
   –í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞ –ù–ï –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ—à–∏–±–æ–∫ —Ç–∏–ø–∞:
   ```
   Cannot read property 'username' of undefined
   ```

## üìù –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

1. **client/pages/SocialNotifications.tsx**
   - –£–±—Ä–∞–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ `from_user`
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ `notification.actor`

2. **client/services/api/custom-backend.ts**
   - –î–æ–±–∞–≤–ª–µ–Ω –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ –ø–æ–ª—é `actor` –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ `Notification`
   - –£—Ç–æ—á–Ω–µ–Ω–æ —á—Ç–æ backend –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç user info –≤ –ø–æ–ª–µ `actor`

## üéâ –†–µ–∑—É–ª—å—Ç–∞—Ç

### –¢–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞—é—Ç –≤—Å–µ —Ç–∏–ø—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π:

- ‚úÖ **Follow** - "–ø–æ–¥–ø–∏—Å–∞–ª—Å—è –Ω–∞ –≤–∞—à–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è"
- ‚úÖ **Like** - "–ª–∞–π–∫–Ω—É–ª –≤–∞—à –ø–æ—Å—Ç"
- ‚úÖ **Retweet** - "–ø–æ–¥–µ–ª–∏–ª—Å—è –≤–∞—à–∏–º –ø–æ—Å—Ç–æ–º"
- ‚úÖ **Mention** - "—É–ø–æ–º—è–Ω—É–ª –≤–∞—Å –≤ –ø–æ—Å—Ç–µ"
- ‚úÖ **Reply** - "–æ—Ç–≤–µ—Ç–∏–ª –Ω–∞ –≤–∞—à –ø–æ—Å—Ç"

–í—Å–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è —Å:
- ‚úÖ –ê–≤–∞—Ç–∞—Ä–æ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚úÖ –ò–º–µ–Ω–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚úÖ Username (@username)
- ‚úÖ Verified badge (–µ—Å–ª–∏ –µ—Å—Ç—å)
- ‚úÖ –í—Ä–µ–º–µ–Ω–Ω–æ–π –º–µ—Ç–∫–æ–π
- ‚úÖ –¢–µ–∫—Å—Ç–æ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

- `DEBUG_FOLLOW_NOTIFICATIONS.md` - –ü–æ–ª–Ω—ã–π –≥–∞–π–¥ –ø–æ –æ—Ç–ª–∞–¥–∫–µ
- `HOVER_CARD_FOLLOW_FIX_COMPLETE.md` - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ hover-–∫–∞—Ä—Ç–æ—á–∫–∏
- `FOLLOW_FUNCTIONALITY_FIX_REPORT.md` - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞ –ø–æ–¥–ø–∏—Å–∫–∏

## üìå –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

### –ü–æ—á–µ–º—É `actor` –∞ –Ω–µ `from_user`?

–í Go –º–æ–¥–µ–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `json:"actor,omitempty"` tag:
```go
FromUser *User `json:"actor,omitempty"`
```

–≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç —á—Ç–æ –ø—Ä–∏ —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –≤ JSON –ø–æ–ª–µ –±—É–¥–µ—Ç –Ω–∞–∑—ã–≤–∞—Ç—å—Å—è `actor`, –∞ –Ω–µ `from_user`.

### –ü–æ—á–µ–º—É –Ω–µ –∏–∑–º–µ–Ω–∏–ª–∏ backend?

Backend –∫–æ–¥ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∏ —Å–ª–µ–¥—É–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–º –ø—Ä–∞–∫—Ç–∏–∫–∞–º:
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç Preload –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å–≤—è–∑–µ–π
- –ü—Ä–∞–≤–∏–ª—å–Ω–æ —Å–µ—Ä–∏–∞–ª–∏–∑—É–µ—Ç –≤ JSON
- –ò–º–µ–µ—Ç –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–ü—Ä–æ–±–ª–µ–º–∞ –±—ã–ª–∞ —Ç–æ–ª—å–∫–æ –≤ –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ –æ–∂–∏–¥–∞–Ω–∏–π –Ω–∞ frontend.

## ‚ö†Ô∏è –í–∞–∂–Ω–æ

–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –ø–æ–¥–ø–∏—Å–∫–∞—Ö –¥–æ–ª–∂–Ω—ã —Ä–∞–±–æ—Ç–∞—Ç—å —Å—Ä–∞–∑—É. –ï—Å–ª–∏ –æ–Ω–∏ –Ω–µ –ø–æ—è–≤–ª—è—é—Ç—Å—è:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ backend –∑–∞–ø—É—â–µ–Ω
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ backend –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø–æ–¥–ø–∏—Å–∫–∏
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –≤ –ë–î —Å–æ–∑–¥–∞—é—Ç—Å—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:
   ```sql
   SELECT * FROM notifications WHERE type = 'follow' ORDER BY created_at DESC LIMIT 5;
   ```

---

**–î–∞—Ç–∞:** 27.10.2025  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û –ò –ì–û–¢–û–í–û –ö –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Æ
